var z=(D,y,c)=>new Promise((n,s)=>{var b=_=>{try{x(c.next(_))}catch(w){s(w)}},V=_=>{try{x(c.throw(_))}catch(w){s(w)}},x=_=>_.done?n(_.value):Promise.resolve(_.value).then(b,V);x((c=c.apply(D,y)).next())});import{fG as W,d as j,a as k,n as G,k as U,e as h,g as o,f as l,w as a,h as f,F as R,l as S,b as C,u as p,gU as H,t as E,gV as M,i as q,gW as X,j as L,gX as Y,gY as Z,gZ as A,g_ as J,H as K,g$ as P,h0 as Q,h1 as ee,fL as i,_ as le}from"./index-DG9AC6Fl.js";import{s as ae,g as se}from"./shops-B4eWs2OP.js";const te=D=>W.request("post","/api/upload",{data:D},{headers:{},timeout:6e4*10}),oe={class:"data-upload-page"},ne={class:"main-content"},ue={class:"card-header"},re={class:"radio-content"},de={class:"file-summary-card"},ie={class:"summary-item"},pe={class:"summary-info"},fe={class:"summary-value"},ce={class:"card-header"},_e={class:"upload-area"},ve={class:"upload-trigger"},me={class:"upload-tip"},ge={class:"action-buttons"},he=j({name:"DataUpload",__name:"index",setup(D){const y=k(),c=k(),n=k({type:"",shop:""}),s=k([]),b=k(!1),V=[{label:"广告文件上传（单日）",value:"ad"},{label:"每日文件上传（单日）",value:"daily"},{label:"商品ID更新",value:"productID"}],x=r=>/\.(csv|xls|xlsx)$/i.test(r),_=r=>x(r.name)?n.value.type?n.value.type==="productID"?s.value.length>=1?(i.error("商品ID更新（全量）类型只能上传一个文件!"),!1):!0:s.value.length<100?!0:(i.error("最多只能上传100个文件!"),!1):(i.error("请先选择上传类型!"),!1):(i.error("只能上传 .csv, .xls, .xlsx 格式的文件!"),!1),w=r=>z(null,null,function*(){var v,g;if(!r)return;if(!n.value.shop){i.warning("请先选择店铺");return}if(!n.value.type){i.warning("请先选择上传类型");return}if(!s.value||!s.value.length){i.warning("请先选择要上传的文件");return}const e=s.value.map(u=>u.raw instanceof File?u.raw:void 0).filter(Boolean);if(!e.length){i.warning("无有效文件可上传");return}const t=new FormData;e.forEach((u,B)=>t.append("files",u)),t.append("type",n.value.type);const m=se(n.value.shop);m&&(t.append("shopID",n.value.shop),t.append("shopName",m.label)),b.value=!0,I(),i.info("上传请求已发送，正在后台处理...");try{const u=yield te(t);u.success?i.success(u.message||"文件上传完成"):i.error(u.message||"上传失败，请重试")}catch(u){console.error("上传错误:",u),i.error(((g=(v=u==null?void 0:u.response)==null?void 0:v.data)==null?void 0:g.message)||(u==null?void 0:u.message)||"上传失败，请重试")}finally{b.value=!1}}),O=K(r=>{w(r)},1e3,!0),I=()=>{var r,e;(r=y.value)==null||r.resetFields(),s.value=[],(e=c.value)==null||e.clearFiles()};return G(()=>n.value.type,(r,e)=>{var t,m,v;r&&r==="productID"&&s.value.length>1&&(s.value=[s.value[0]],(t=c.value)==null||t.clearFiles(),(m=s.value[0])!=null&&m.raw&&((v=c.value)==null||v.handleStart(s.value[0].raw)),i.warning("商品ID更新（全量）类型只能上传一个文件，已自动清除多余文件"))}),(r,e)=>{const t=f("el-icon"),m=f("el-radio-button"),v=f("el-radio-group"),g=f("el-form-item"),u=f("el-radio"),B=f("el-progress"),F=f("el-button"),T=f("el-form"),N=f("el-card"),$=f("el-upload");return h(),U("div",oe,[o("div",ne,[l(N,{class:"config-card",shadow:"hover"},{header:a(()=>[o("div",ue,[l(t,null,{default:a(()=>[l(p(Z))]),_:1}),e[4]||(e[4]=o("span",null,"上传配置",-1))])]),default:a(()=>[l(T,{ref_key:"formRef",ref:y,model:n.value,"label-width":"140px",class:"upload-form"},{default:a(()=>[l(g,{label:"选择店铺",prop:"shop",required:""},{default:a(()=>[l(v,{modelValue:n.value.shop,"onUpdate:modelValue":e[0]||(e[0]=d=>n.value.shop=d),class:"type-group shop-group"},{default:a(()=>[(h(!0),U(R,null,S(p(ae),d=>(h(),C(m,{key:d.value,label:d.value,class:"shop-radio"},{default:a(()=>[l(t,{class:"radio-icon"},{default:a(()=>[l(p(H))]),_:1}),o("span",null,E(d.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(g,{label:"上传类型",prop:"type",required:""},{default:a(()=>[l(v,{modelValue:n.value.type,"onUpdate:modelValue":e[1]||(e[1]=d=>n.value.type=d),class:"type-group"},{default:a(()=>[(h(),U(R,null,S(V,d=>l(u,{key:d.value,label:d.value,class:"type-radio",border:""},{default:a(()=>[o("div",re,[l(t,{class:"radio-icon"},{default:a(()=>[l(p(M))]),_:1}),o("span",null,E(d.label),1)])]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])]),_:1}),l(g,{label:"文件统计"},{default:a(()=>[o("div",de,[o("div",ie,[l(t,{class:"summary-icon"},{default:a(()=>[l(p(X))]),_:1}),o("div",pe,[e[5]||(e[5]=o("span",{class:"summary-label"},"已选文件",-1)),o("span",fe,E(s.value.length)+" / 100",1)])]),l(B,{percentage:s.value.length/100*100,"stroke-width":8,"show-text":!1,class:"progress-bar"},null,8,["percentage"]),s.value.length?(h(),C(F,{key:0,type:"danger",size:"small",plain:"",onClick:I},{default:a(()=>[l(t,null,{default:a(()=>[l(p(Y))]),_:1}),e[6]||(e[6]=L(" 清空全部 ",-1))]),_:1})):q("",!0)])]),_:1})]),_:1},8,["model"])]),_:1}),l(N,{class:"upload-card",shadow:"hover"},{header:a(()=>[o("div",ce,[l(t,null,{default:a(()=>[l(p(ee))]),_:1}),e[7]||(e[7]=o("span",null,"文件上传",-1))])]),default:a(()=>[o("div",_e,[l($,{ref_key:"uploadRef",ref:c,"file-list":s.value,"onUpdate:fileList":e[2]||(e[2]=d=>s.value=d),class:"upload-demo","auto-upload":!1,"show-file-list":!0,"before-upload":_,multiple:n.value.type&&n.value.type!=="productID",accept:".csv,.xls,.xlsx",action:"#",drag:""},{trigger:a(()=>[o("div",ve,[l(t,{class:"upload-icon",size:48},{default:a(()=>[l(p(J))]),_:1}),e[8]||(e[8]=o("p",{class:"upload-text"},"点击或拖拽文件到此区域上传",-1)),e[9]||(e[9]=o("p",{class:"upload-hint"},"支持 .csv / .xls / .xlsx 格式文件",-1))])]),tip:a(()=>[o("div",me,[l(t,null,{default:a(()=>[l(p(A))]),_:1}),e[10]||(e[10]=o("span",null,"请勿修改文件名、文件格式或文件内容",-1))])]),_:1},8,["file-list","multiple"])]),o("div",ge,[l(F,{type:"primary",size:"large",class:"submit-btn",disabled:!s.value.length||!n.value.shop||!n.value.type,loading:b.value,onClick:e[3]||(e[3]=d=>p(O)(y.value))},{default:a(()=>[l(t,null,{default:a(()=>[l(p(P))]),_:1}),e[11]||(e[11]=L(" 提交上传 ",-1))]),_:1},8,["disabled","loading"]),s.value.length?(h(),C(F,{key:0,size:"large",class:"cancel-btn",onClick:I},{default:a(()=>[l(t,null,{default:a(()=>[l(p(Q))]),_:1}),e[12]||(e[12]=L(" 取消并清空 ",-1))]),_:1})):q("",!0)])]),_:1})])])}}}),we=le(he,[["__scopeId","data-v-07852d9f"]]);export{we as default};
