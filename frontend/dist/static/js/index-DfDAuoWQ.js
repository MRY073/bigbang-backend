var De=Object.defineProperty,Ae=Object.defineProperties;var Le=Object.getOwnPropertyDescriptors;var ce=Object.getOwnPropertySymbols;var Ie=Object.prototype.hasOwnProperty,Me=Object.prototype.propertyIsEnumerable;var de=(C,y,v)=>y in C?De(C,y,{enumerable:!0,configurable:!0,writable:!0,value:v}):C[y]=v,ve=(C,y)=>{for(var v in y||(y={}))Ie.call(y,v)&&de(C,v,y[v]);if(ce)for(var v of ce(y))Me.call(y,v)&&de(C,v,y[v]);return C},ge=(C,y)=>Ae(C,Le(y));var G=(C,y,v)=>new Promise((_,z)=>{var Y=b=>{try{B(v.next(b))}catch(w){z(w)}},U=b=>{try{B(v.throw(b))}catch(w){z(w)}},B=b=>b.done?_(b.value):Promise.resolve(b.value).then(Y,U);B((v=v.apply(C,y)).next())});import{d as Ee,a as p,gr as Ne,p as le,n as ze,m as Oe,k as n,e as i,g as o,f as m,w as k,F as f,l as h,h as V,b as ye,j as K,i as R,t as d,u as ae,h4 as Pe,v as P,s as H,h5 as Ye,fJ as Ue,fL as fe,fM as We,_ as je}from"./index-DK89ZJMH.js";import{b as Te,c as $e}from"./monitor-jT8Se29p.js";import{a as He}from"./productItems-DoU_wn2M.js";const Je={class:"potential-monitor-page"},Re={class:"controls"},qe={class:"cards"},Ge={class:"card-row top"},Ke={class:"left"},Qe=["src"],Xe={key:1,class:"prod-img placeholder"},Ze={class:"meta"},et={class:"id"},tt={class:"name"},lt={class:"warn-row"},at={key:0,class:"warning-messages"},st={class:"follow-area"},ot={key:0,class:"follow-time"},it={class:"metrics"},nt={class:"metric-block"},rt={class:"metric-values"},ut={class:"metric-block"},ct={class:"metric-values volatility-values"},dt={class:"volatility-window",style:{color:"#000000"}},vt={class:"volatility-direction",style:{color:"#000000"}},gt={class:"volatility-strength",style:{color:"#000000"}},yt={class:"metric-block"},ft={class:"metric-values"},mt={class:"metric-block"},_t={class:"metric-values volatility-values"},pt={class:"volatility-window",style:{color:"#000000"}},ht={class:"volatility-direction",style:{color:"#000000"}},Ct={class:"volatility-strength",style:{color:"#000000"}},wt={class:"metric-block"},kt={class:"metric-values"},bt={class:"metric-block"},Vt={class:"metric-values volatility-values"},Bt={class:"volatility-window",style:{color:"#000000"}},Ft={class:"volatility-direction",style:{color:"#000000"}},xt={class:"volatility-strength",style:{color:"#000000"}},St={class:"pagination-wrapper"},Dt={key:0,style:{"text-align":"center",padding:"20px"}},At={key:1,style:{"white-space":"pre-wrap","line-height":"1.6",color:"#303133","max-height":"400px","overflow-y":"auto"}},Lt=Ee({name:"PotentialLinkMonitor",__name:"index",setup(C){const y=p([]),v=p(!1),_=p("1489850435"),z=p(Ne().format("YYYY-MM-DD")),Y=p(!1),U=p(""),B=p(!1),b=p(""),w=p(1),q=p(10),se=le(()=>{let s=y.value;if(O.value){const e=O.value.trim().toLowerCase();s=s.filter(c=>oe.some(r=>{const u=c[r];return typeof u=="string"?u.toLowerCase().includes(e):!1}))}return s}),me=le(()=>{const s=(w.value-1)*q.value,e=s+q.value;return se.value.slice(s,e)}),_e=le(()=>se.value.length),Q=[{label:"Modern Nest|泰国",value:"1489850435"},{label:"shop07|泰国",value:"1638595255"}],J=p([]),O=p(""),oe=["custom_category_1","custom_category_2","custom_category_3","custom_category_4"];function pe(s="加载中..."){return We.service({lock:!0,text:s,background:"rgba(0,0,0,0.2)"})}const W=p({});function he(s,e){W.value[s]||(W.value[s]={on:!1}),W.value[s].on=e,W.value[s].time=e?new Date().toLocaleString():void 0}function X(s){var e;return!!((e=W.value[s])!=null&&e.on)}function Ce(s){var e,c;return(c=(e=W.value[s])==null?void 0:e.time)!=null?c:""}function ie(s){return parseFloat(s.toFixed(2)).toString()}function we(s){return parseFloat(s.toFixed(2)).toLocaleString()}function Z(s){return s==null||isNaN(s)?"0.00":s.toFixed(2)}const ee=[1,3,7,15,30],j={1:"#FF6F91",3:"#FF9B6A",7:"#FFD33D",15:"#4A00E0",30:"#0066CC"},te={极小:"#6C63FF",轻微:"#2DE2E6",一般:"#FF9B6A",明显:"#FF6F91",剧烈:"#FF3F6C"};function ke(){return G(this,null,function*(){if(!_.value){fe.warning("请先选择店铺");return}v.value=!0;const s=pe("拉取数据...");try{const e=Q.find(u=>u.value===_.value);if(!e)throw new Error("店铺信息不存在");const c={shopID:_.value,shopName:e.label,date:z.value};O.value&&(c.customCategory=O.value);const r=yield Te(c);if(r.code===200&&r.data){if(y.value=(r.data||[]).map(u=>ge(ve({},u),{visitorsVolatilityBaseline:u.visitorsVolatilityBaseline||[],adCostVolatilityBaseline:u.adCostVolatilityBaseline||[],salesVolatilityBaseline:u.salesVolatilityBaseline||[],warningMessages:u.warningMessages||[]})),r.data&&Array.isArray(r.data)){const u=[];r.data.forEach(F=>{oe.forEach(T=>{const $=F[T];typeof $=="string"&&$.trim()&&u.push($.trim())})}),ne([...new Set(u)])}w.value=1}else throw new Error(r.error||r.message||"查询失败")}catch(e){console.error("拉取数据失败:",e),w.value=1}finally{s.close(),v.value=!1}})}function be(s,e){return G(this,null,function*(){b.value=s,Y.value=!0,U.value="",B.value=!0;try{const c=Q.find(u=>u.value===_.value);if(!c)throw new Error("店铺信息不存在");const r=yield $e({shopID:_.value,shopName:c.label,date:z.value,productID:s,productName:e});if(r.success&&r.data)U.value=r.data.suggestion||"暂无建议";else throw new Error(r.error||r.message||"获取AI建议失败")}catch(c){console.error("获取AI建议失败:",c),fe.error((c==null?void 0:c.message)||"获取AI建议失败，请稍后重试"),U.value="获取AI建议失败，请稍后重试"}finally{B.value=!1}})}function Ve(s){return s.map(e=>{var c,r,u,F,T;return typeof e=="string"?e:e&&typeof e=="object"&&(T=(F=(u=(r=(c=e.label)!=null?c:e.name)!=null?r:e.value)!=null?u:e.key)!=null?F:e.id)!=null?T:""}).map(e=>typeof e=="string"?e.trim():"").filter(Boolean)}function ne(s){if(!s.length)return;const e=new Set(J.value.map(r=>r.value));let c=!1;s.forEach(r=>{const u=r.trim();!u||e.has(u)||(J.value.push({label:u,value:u}),e.add(u),c=!0)}),c&&J.value.sort((r,u)=>r.label.localeCompare(u.label,"zh-Hans-CN"))}function re(){return G(this,null,function*(){if(_.value)try{const s=yield He({shopID:_.value});if(s.success&&Array.isArray(s.data))ne(Ve(s.data));else throw new Error(s.error||s.message||"获取分类失败")}catch(s){console.error("获取自定义分类选项失败:",s)}})}function Be(){w.value=1}function ue(){J.value=[],O.value="",_.value&&re(),w.value=1}return ze(_,()=>{ue()}),Oe(()=>{_.value&&re()}),(s,e)=>{const c=V("el-option"),r=V("el-select"),u=V("el-date-picker"),F=V("el-button"),T=V("el-tag"),$=V("el-icon"),Fe=V("el-switch"),xe=V("el-card"),Se=V("el-pagination");return i(),n("div",Je,[o("div",Re,[m(r,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=t=>_.value=t),placeholder:"选择店铺",style:{width:"200px","margin-right":"12px"},onChange:ue},{default:k(()=>[(i(),n(f,null,h(Q,t=>m(c,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),m(r,{modelValue:O.value,"onUpdate:modelValue":e[1]||(e[1]=t=>O.value=t),placeholder:"请选择自定义分类",clearable:"",filterable:"",style:{width:"220px","margin-right":"12px"},onChange:Be},{default:k(()=>[(i(!0),n(f,null,h(J.value,t=>(i(),ye(c,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),m(u,{modelValue:z.value,"onUpdate:modelValue":e[2]||(e[2]=t=>z.value=t),type:"date",placeholder:"选择日期","value-format":"YYYY-MM-DD","disabled-date":t=>t>new Date,style:{width:"200px","margin-right":"12px"}},null,8,["modelValue","disabled-date"]),m(F,{type:"primary",loading:v.value,icon:"el-icon-refresh",onClick:ke},{default:k(()=>[...e[8]||(e[8]=[K("拉取数据",-1)])]),_:1},8,["loading"])]),o("div",qe,[(i(!0),n(f,null,h(me.value,t=>(i(),ye(xe,{key:t.id,class:P(["prod-card",{"prod-followed":X(t.id)}])},{default:k(()=>[o("div",Ge,[o("div",Ke,[t.image?(i(),n("img",{key:0,src:t.image,alt:"主图",class:"prod-img"},null,8,Qe)):(i(),n("div",Xe,"无图"))]),o("div",Ze,[o("div",et,d(t.id),1),o("div",tt,d(t.name),1),o("div",lt,[m(T,{type:t.warningLevel==="严重"?"danger":t.warningLevel==="一般"?"warning":t.warningLevel==="轻微"?"info":"success"},{default:k(()=>[K(d(t.warningLevel),1)]),_:2},1032,["type"])]),t.warningMessages&&t.warningMessages.length>0?(i(),n("div",at,[(i(!0),n(f,null,h(t.warningMessages,(a,g)=>(i(),n("div",{key:g,class:"warning-message-item"},[m($,{class:"warning-icon"},{default:k(()=>[m(ae(Pe))]),_:1}),o("span",null,d(a),1)]))),128))])):R("",!0)]),o("div",st,[m(F,{type:"primary",size:"small",loading:B.value&&b.value===t.id,style:{"margin-right":"12px"},onClick:a=>be(t.id,t.name)},{default:k(()=>[...e[9]||(e[9]=[K(" 获取AI建议 ",-1)])]),_:1},8,["loading","onClick"]),m(Fe,{"model-value":X(t.id),"active-text":"已关注","inactive-text":"未关注",onChange:a=>he(t.id,!!a)},null,8,["model-value","onChange"]),X(t.id)?(i(),n("div",ot,d(Ce(t.id)),1)):R("",!0)])]),o("div",it,[o("div",nt,[e[10]||(e[10]=o("div",{class:"metric-title"},"日均访客(30/15/7/3/1日)",-1)),o("div",rt,[(i(!0),n(f,null,h(t.visitorsAvg,(a,g)=>(i(),n("span",{key:g,class:P(["metric-value","c"+g])},d(ie(a)),3))),128))])]),o("div",ut,[e[11]||(e[11]=o("div",{class:"metric-title"},"访客数短期波动相对长期基准(60)指标",-1)),o("div",ct,[(i(!0),n(f,null,h(ee.filter(a=>a!==1),a=>{var g,x,S,D,A,L,I,M,E,N;return i(),n("span",{key:a,class:P(["volatility-item",{"volatility-highlight":((x=(g=t.visitorsVolatilityBaseline)==null?void 0:g.find(l=>l.window===a))==null?void 0:x.level)==="明显"||((D=(S=t.visitorsVolatilityBaseline)==null?void 0:S.find(l=>l.window===a))==null?void 0:D.level)==="剧烈","volatility-subtle":((L=(A=t.visitorsVolatilityBaseline)==null?void 0:A.find(l=>l.window===a))==null?void 0:L.level)==="极小"||((M=(I=t.visitorsVolatilityBaseline)==null?void 0:I.find(l=>l.window===a))==null?void 0:M.level)==="轻微"||((N=(E=t.visitorsVolatilityBaseline)==null?void 0:E.find(l=>l.window===a))==null?void 0:N.level)==="一般"}]),style:H({borderColor:j[a],backgroundColor:j[a]+"40"})},[t.visitorsVolatilityBaseline&&t.visitorsVolatilityBaseline.find(l=>l.window===a)?(i(!0),n(f,{key:0},h(t.visitorsVolatilityBaseline.filter(l=>l.window===a),l=>(i(),n(f,{key:l.window},[o("span",dt,d(a)+"天 ",1),o("span",vt,d(l.direction==="+"?"↑":"↓"),1),o("span",gt,d(Z(l.strength))+"% ",1),o("span",{class:"volatility-level",style:H({color:"#000000",backgroundColor:te[l.level]||"#6b7280"})}," ["+d(l.level)+"] ",5)],64))),128)):R("",!0)],6)}),128))])]),o("div",yt,[e[12]||(e[12]=o("div",{class:"metric-title"},"日均广告花费(30/15/7/3/1日)",-1)),o("div",ft,[(i(!0),n(f,null,h(t.adCostAvg,(a,g)=>(i(),n("span",{key:g,class:P(["metric-value","c"+g])},d(ie(a)),3))),128))])]),o("div",mt,[e[13]||(e[13]=o("div",{class:"metric-title"},"广告花费短期波动相对长期基准(60)指标",-1)),o("div",_t,[(i(!0),n(f,null,h(ee.filter(a=>a!==1),a=>{var g,x,S,D,A,L,I,M,E,N;return i(),n("span",{key:a,class:P(["volatility-item",{"volatility-highlight":((x=(g=t.adCostVolatilityBaseline)==null?void 0:g.find(l=>l.window===a))==null?void 0:x.level)==="明显"||((D=(S=t.adCostVolatilityBaseline)==null?void 0:S.find(l=>l.window===a))==null?void 0:D.level)==="剧烈","volatility-subtle":((L=(A=t.adCostVolatilityBaseline)==null?void 0:A.find(l=>l.window===a))==null?void 0:L.level)==="极小"||((M=(I=t.adCostVolatilityBaseline)==null?void 0:I.find(l=>l.window===a))==null?void 0:M.level)==="轻微"||((N=(E=t.adCostVolatilityBaseline)==null?void 0:E.find(l=>l.window===a))==null?void 0:N.level)==="一般"}]),style:H({borderColor:j[a],backgroundColor:j[a]+"40"})},[t.adCostVolatilityBaseline&&t.adCostVolatilityBaseline.find(l=>l.window===a)?(i(!0),n(f,{key:0},h(t.adCostVolatilityBaseline.filter(l=>l.window===a),l=>(i(),n(f,{key:l.window},[o("span",pt,d(a)+"天 ",1),o("span",ht,d(l.direction==="+"?"↑":"↓"),1),o("span",Ct,d(Z(l.strength))+"% ",1),o("span",{class:"volatility-level",style:H({color:"#000000",backgroundColor:te[l.level]||"#6b7280"})}," ["+d(l.level)+"] ",5)],64))),128)):R("",!0)],6)}),128))])]),o("div",wt,[e[14]||(e[14]=o("div",{class:"metric-title"},"日均销售额(30/15/7/3/1日)",-1)),o("div",kt,[(i(!0),n(f,null,h(t.salesAvg,(a,g)=>(i(),n("span",{key:g,class:P(["metric-value","c"+g])},d(we(a)),3))),128))])]),o("div",bt,[e[15]||(e[15]=o("div",{class:"metric-title"},"销售额短期波动相对长期基准(60)指标",-1)),o("div",Vt,[(i(!0),n(f,null,h(ee.filter(a=>a!==1),a=>{var g,x,S,D,A,L,I,M,E,N;return i(),n("span",{key:a,class:P(["volatility-item",{"volatility-highlight":((x=(g=t.salesVolatilityBaseline)==null?void 0:g.find(l=>l.window===a))==null?void 0:x.level)==="明显"||((D=(S=t.salesVolatilityBaseline)==null?void 0:S.find(l=>l.window===a))==null?void 0:D.level)==="剧烈","volatility-subtle":((L=(A=t.salesVolatilityBaseline)==null?void 0:A.find(l=>l.window===a))==null?void 0:L.level)==="极小"||((M=(I=t.salesVolatilityBaseline)==null?void 0:I.find(l=>l.window===a))==null?void 0:M.level)==="轻微"||((N=(E=t.salesVolatilityBaseline)==null?void 0:E.find(l=>l.window===a))==null?void 0:N.level)==="一般"}]),style:H({borderColor:j[a],backgroundColor:j[a]+"40"})},[t.salesVolatilityBaseline&&t.salesVolatilityBaseline.find(l=>l.window===a)?(i(!0),n(f,{key:0},h(t.salesVolatilityBaseline.filter(l=>l.window===a),l=>(i(),n(f,{key:l.window},[o("span",Bt,d(a)+"天 ",1),o("span",Ft,d(l.direction==="+"?"↑":"↓"),1),o("span",xt,d(Z(l.strength))+"% ",1),o("span",{class:"volatility-level",style:H({color:"#FFFFFF",backgroundColor:te[l.level]||"#6b7280"})}," ["+d(l.level)+"] ",5)],64))),128)):R("",!0)],6)}),128))])])])]),_:2},1032,["class"]))),128))]),o("div",St,[m(Se,{"current-page":w.value,"onUpdate:currentPage":e[3]||(e[3]=t=>w.value=t),"page-size":q.value,"onUpdate:pageSize":e[4]||(e[4]=t=>q.value=t),"page-sizes":[10,20,50,100],total:_e.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:e[5]||(e[5]=()=>w.value=1)},null,8,["current-page","page-size","total"])]),m(ae(Ue),{modelValue:Y.value,"onUpdate:modelValue":e[7]||(e[7]=t=>Y.value=t),title:"AI建议",width:"600px","close-on-click-modal":!1},{footer:k(()=>[m(F,{onClick:e[6]||(e[6]=t=>Y.value=!1)},{default:k(()=>[...e[17]||(e[17]=[K("关闭",-1)])]),_:1})]),default:k(()=>[B.value?(i(),n("div",Dt,[m($,{class:"is-loading",style:{"font-size":"24px"}},{default:k(()=>[m(ae(Ye))]),_:1}),e[16]||(e[16]=o("p",{style:{"margin-top":"10px"}},"AI正在分析中...",-1))])):(i(),n("div",At,d(U.value||"暂无建议"),1))]),_:1},8,["modelValue"])])}}}),zt=je(Lt,[["__scopeId","data-v-de52d2eb"]]);export{zt as default};
