var k=(O,l,u)=>new Promise((p,h)=>{var b=_=>{try{y(u.next(_))}catch(d){h(d)}},T=_=>{try{y(u.throw(_))}catch(d){h(d)}},y=_=>_.done?p(_.value):Promise.resolve(_.value).then(b,T);y((u=u.apply(O,l)).next())});import{a as z}from"./products-D_zf0K7g.js";import{d as F,a as x,k as m,e as c,g as r,b as I,f as C,w,F as $,l as K,h as S,j as N,v as j,i as D,t as f,fL as v,fM as Y,_ as q}from"./index-BBIx6VGs.js";const G={class:"trial-monitor-page"},J={class:"controls"},Q={key:1,class:"grid"},R={class:"card-top"},W={class:"img-area"},X=["src"],Z={key:1,class:"thumb placeholder"},tt={class:"info-area"},et=["onClick"],st=["title"],at={class:"tags"},ot={class:"card-metrics"},nt={class:"metric"},rt={class:"value"},it={class:"metric"},lt={class:"value"},ct={class:"metric"},dt={class:"value"},ut={class:"card-foot"},_t={key:0,class:"hint"},gt=F({name:"TrialLinkMonitor",__name:"index",setup(O){const l=x([]),u=x(!1),p=x("1489850435"),h=[{label:"Modern Nest|泰国",value:"1489850435"},{label:"shop07|泰国",value:"1638595255"}];function b(e="加载中..."){return Y.service({lock:!0,text:e,background:"rgba(0,0,0,0.2)"})}function T(e){return e.toLocaleString("zh-CN")}function y(e){if(!e)return"未设置";try{const t=e.match(/^(\d{4})-(\d{2})-(\d{2})/);if(t){const o=parseInt(t[1],10),s=parseInt(t[2],10),i=parseInt(t[3],10);if(o>=1900&&o<=2100&&s>=1&&s<=12&&i>=1&&i<=31)return`${o}-${String(s).padStart(2,"0")}-${String(i).padStart(2,"0")}`}const a=new Date(e);if(!isNaN(a.getTime())){const o=a.getFullYear(),s=String(a.getMonth()+1).padStart(2,"0"),i=String(a.getDate()).padStart(2,"0");return`${o}-${s}-${i}`}return"日期格式错误"}catch(t){return"日期格式错误"}}function _(e){if(!e)return!1;try{const t=e.match(/^(\d{4})-(\d{2})-(\d{2})/);if(!t)return!1;const a=parseInt(t[1],10),o=parseInt(t[2],10)-1,s=parseInt(t[3],10),i=new Date(a,o,s),g=new Date;g.setHours(0,0,0,0),i.setHours(0,0,0,0);const n=g.getTime()-i.getTime();return Math.floor(n/(1e3*60*60*24))>=15}catch(t){return!1}}function d(e){const t=e.total_visitors,a=e.total_orders,o=_(e.testing_stage_start);return t>100||a>6||o?"finished":t>=50&&t<=100||a>=3&&a<=6?"watching":"normal"}function V(e){const t=d(e);return t==="finished"?"card-status-finished":t==="watching"?"card-status-watching":"card-status-normal"}function E(e){const t=d(e);return t==="finished"?"测款已完成，需马上处理":t==="watching"?"数据优秀情况下及时转为潜力款，需尽快处理":""}function M(e){return e==="finished"?1:e==="watching"?2:3}function U(e){return[...e].sort((t,a)=>{const o=d(t),s=d(a);return M(o)-M(s)})}function B(){const e=new Date,t=new Date(e);t.setDate(e.getDate()-20);const a=new Date(e);a.setDate(e.getDate()-10);const o=new Date(e);o.setDate(e.getDate()-5),l.value=[{product_id:"SKU-T1001",product_name:"测款 — 轻便跑鞋",product_image:"https://via.placeholder.com/160?text=T1001",testing_stage_start:t.toISOString().split("T")[0],total_orders:2,total_visitors:60},{product_id:"SKU-T1002",product_name:"测款 — 多功能杯",product_image:"https://via.placeholder.com/160?text=T1002",testing_stage_start:a.toISOString().split("T")[0],total_orders:7,total_visitors:85},{product_id:"SKU-T1003",product_name:"测款 — 智能照明灯",product_image:"https://via.placeholder.com/160?text=T1003",testing_stage_start:o.toISOString().split("T")[0],total_orders:4,total_visitors:120},{product_id:"SKU-T1004",product_name:"测款 — 创意手机支架",product_image:null,testing_stage_start:o.toISOString().split("T")[0],total_orders:5,total_visitors:75},{product_id:"SKU-T1005",product_name:"测款 — 多彩背包",product_image:"https://via.placeholder.com/160?text=T1005",testing_stage_start:a.toISOString().split("T")[0],total_orders:1,total_visitors:65},{product_id:"SKU-T1006",product_name:"测款 — 简约水杯",product_image:"https://via.placeholder.com/160?text=T1006",testing_stage_start:o.toISOString().split("T")[0],total_orders:0,total_visitors:30},{product_id:"SKU-T1007",product_name:"测款 — 运动手环",product_image:"https://via.placeholder.com/160?text=T1007",testing_stage_start:a.toISOString().split("T")[0],total_orders:2,total_visitors:45}]}function L(){return k(this,null,function*(){var t,a,o;if(!p.value){v.warning("请先选择店铺");return}u.value=!0;const e=b("拉取数据中...");try{const s=h.find(g=>g.value===p.value);if(!s)throw new Error("店铺信息不存在");const i=yield z({shopID:p.value,shopName:s.label});if(i.success&&i.data){const g=i.data;l.value=U(g),l.value.length===0?v.info("当前店铺暂无测款商品"):v.success(i.message||`查询成功，共 ${l.value.length} 条数据`)}else throw new Error(i.error||i.message||"查询失败")}catch(s){console.error("拉取数据失败:",s),(t=s==null?void 0:s.message)!=null&&t.includes("HTTP error")||(a=s==null?void 0:s.message)!=null&&a.includes("fetch")||(o=s==null?void 0:s.message)!=null&&o.includes("Network")?(B(),l.value=U(l.value),v.info("使用本地示例数据（后端不可用）")):(v.error((s==null?void 0:s.message)||"网络连接失败，请检查网络后重试"),l.value=[])}finally{e.close(),u.value=!1}})}function A(e){var o;const t=e.target;t.style.display="none";const a=document.createElement("div");a.className="thumb placeholder",a.textContent="无图",(o=t.parentElement)==null||o.appendChild(a)}function H(e){return k(this,null,function*(){try{if(navigator.clipboard&&navigator.clipboard.writeText)yield navigator.clipboard.writeText(e);else{const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}v.success("已复制到剪贴板")}catch(t){v.error("复制失败")}})}return(e,t)=>{const a=S("el-option"),o=S("el-select"),s=S("el-button"),i=S("el-empty"),g=S("el-tag");return c(),m("div",G,[r("div",J,[C(o,{modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=n=>p.value=n),placeholder:"选择店铺",style:{width:"200px","margin-right":"12px"}},{default:w(()=>[(c(),m($,null,K(h,n=>C(a,{key:n.value,label:n.label,value:n.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),C(s,{type:"primary",loading:u.value,icon:"el-icon-refresh",onClick:L},{default:w(()=>[...t[1]||(t[1]=[N("拉取数据",-1)])]),_:1},8,["loading"])]),!u.value&&l.value.length===0&&p.value?(c(),I(i,{key:0,description:"当前店铺暂无测款商品","image-size":120})):(c(),m("div",Q,[(c(!0),m($,null,K(l.value,n=>(c(),m("div",{key:n.product_id,class:j(["prod-card",V(n)])},[r("div",R,[r("div",W,[n.product_image?(c(),m("img",{key:0,src:n.product_image,alt:"主图",class:"thumb",onError:A},null,40,X)):D("",!0),n.product_image?D("",!0):(c(),m("div",Z,"无图"))]),r("div",tt,[r("div",{class:"id",title:"点击复制ID",onClick:P=>H(n.product_id)},f(n.product_id),9,et),r("div",{class:"name",title:n.product_name},f(n.product_name),9,st),r("div",at,[d(n)==="finished"?(c(),I(g,{key:0,type:"danger"},{default:w(()=>[...t[2]||(t[2]=[N("测款完毕",-1)])]),_:1})):d(n)==="watching"?(c(),I(g,{key:1,type:"warning"},{default:w(()=>[...t[3]||(t[3]=[N("测款关注中",-1)])]),_:1})):D("",!0)])])]),r("div",ot,[r("div",nt,[t[4]||(t[4]=r("div",{class:"label"},"测款日期开始",-1)),r("div",rt,f(y(n.testing_stage_start)),1)]),r("div",it,[t[5]||(t[5]=r("div",{class:"label"},"出单数",-1)),r("div",lt,f(T(n.total_orders)),1)]),r("div",ct,[t[6]||(t[6]=r("div",{class:"label"},"累计访客",-1)),r("div",dt,f(T(n.total_visitors)),1)])]),r("div",ut,[E(n)?(c(),m("div",_t,f(E(n)),1)):D("",!0)])],2))),128))]))])}}}),ft=q(gt,[["__scopeId","data-v-960bf0fb"]]);export{ft as default};
