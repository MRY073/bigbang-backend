var Ae=Object.defineProperty,xe=Object.defineProperties;var Fe=Object.getOwnPropertyDescriptors;var re=Object.getOwnPropertySymbols;var Se=Object.prototype.hasOwnProperty,Le=Object.prototype.propertyIsEnumerable;var de=(m,g,c)=>g in m?Ae(m,g,{enumerable:!0,configurable:!0,writable:!0,value:c}):m[g]=c,ce=(m,g)=>{for(var c in g||(g={}))Se.call(g,c)&&de(m,c,g[c]);if(re)for(var c of re(g))Le.call(g,c)&&de(m,c,g[c]);return m},ve=(m,g)=>xe(m,Fe(g));var G=(m,g,c)=>new Promise((h,B)=>{var j=p=>{try{_(c.next(p))}catch(b){B(b)}},R=p=>{try{_(c.throw(p))}catch(b){B(b)}},_=p=>p.done?h(p.value):Promise.resolve(p.value).then(j,R);_((c=c.apply(m,g)).next())});import{d as Me,a as C,gr as De,p as ee,n as Ee,m as Ie,k as a,e as o,g as n,f as V,w as I,j as te,h as N,F as y,l as f,b as H,u as J,i as $,h3 as Ne,h4 as Oe,t as u,h5 as Ue,v as Y,s as W,fL as O,h6 as ze,fM as Ye,_ as Ke}from"./index-DG9AC6Fl.js";import{g as Pe,b as ue}from"./monitor-C3fBk2Ol.js";import{g as We}from"./productItems-CaFZYQ76.js";import{s as je,g as ge,D as Re}from"./shops-B4eWs2OP.js";const Te={class:"finished-monitor-page"},Ge={class:"controls"},He={class:"cards"},$e={class:"card-row top"},qe=["onClick"],Je={class:"left"},Qe=["src"],Xe={key:1,class:"prod-img placeholder"},Ze={class:"meta"},et={class:"id"},tt={class:"name"},lt={class:"warn-row"},it={key:0,class:"warning-messages"},st={key:0,class:"metrics"},nt={class:"metric-block"},ot={class:"metric-values"},at={class:"metric-block"},rt={class:"metric-values volatility-values"},dt={class:"volatility-window",style:{color:"#000000"}},ct={class:"volatility-direction",style:{color:"#000000"}},vt={class:"volatility-strength",style:{color:"#000000"}},ut={class:"metric-block"},gt={class:"metric-values"},wt={class:"metric-block"},ht={class:"metric-values volatility-values"},yt={class:"volatility-window",style:{color:"#000000"}},ft={class:"volatility-direction",style:{color:"#000000"}},mt={class:"volatility-strength",style:{color:"#000000"}},_t={class:"metric-block"},pt={class:"metric-values"},Ct={class:"metric-block"},Vt={class:"metric-values volatility-values"},Bt={class:"volatility-window",style:{color:"#000000"}},bt={class:"volatility-direction",style:{color:"#000000"}},kt={class:"volatility-strength",style:{color:"#000000"}},At={class:"pagination-wrapper"},xt=Me({name:"FinishedLinkMonitor",__name:"index",setup(m){const g=C([]),c=C(!1),h=C(Re),B=C(De().format("YYYY-MM-DD")),j=C({}),R=C(!1),_=C(1),p=C(10),b=C([]),U=C(""),le=["custom_category_1","custom_category_2","custom_category_3","custom_category_4"],ie=ee(()=>{let s=g.value;if(U.value){const t=U.value.trim().toLowerCase();s=s.filter(w=>le.some(d=>{const r=w[d];return typeof r=="string"?r.toLowerCase().includes(t):!1}))}return s}),we=ee(()=>{const s=(_.value-1)*p.value,t=s+p.value;return ie.value.slice(s,t)}),he=ee(()=>ie.value.length);function ye(s="加载中..."){return Ye.service({lock:!0,text:s,background:"rgba(0,0,0,0.2)"})}function fe(s){j.value[s]=!j.value[s]}function q(s){return!!j.value[s]}function se(s){return parseFloat(s.toFixed(2)).toString()}function me(s){return parseFloat(s.toFixed(2)).toLocaleString()}function Q(s){return s==null||isNaN(s)?"0.00":s.toFixed(2)}const X=[1,3,7,15,30],K={1:"#E91E63",3:"#FF5722",7:"#FFC107",15:"#3F51B5",30:"#00BCD4"},Z={极小:"#3F51B5",轻微:"#00BCD4",一般:"#FF5722",明显:"#E91E63",剧烈:"#C2185B"};function _e(){g.value=[{id:"SKU-1001",name:"成品 — 舒适运动鞋",image:"https://via.placeholder.com/120?text=SKU-1001",visitorsAvg:[4200,4500,4700,4900,5100],visitorsVolatilityBaseline:[{window:1,direction:"+",strength:21.4,level:"一般"},{window:3,direction:"+",strength:18.6,level:"轻微"},{window:7,direction:"+",strength:15.2,level:"轻微"},{window:15,direction:"+",strength:12.3,level:"轻微"},{window:30,direction:"+",strength:8.5,level:"极小"}],adCostAvg:[1200.5,1400.2,1500.3,1600,1700.9],adCostVolatilityBaseline:[{window:1,direction:"+",strength:15.3,level:"轻微"},{window:3,direction:"+",strength:12.8,level:"轻微"},{window:7,direction:"+",strength:10.5,level:"轻微"},{window:15,direction:"+",strength:8.1,level:"极小"},{window:30,direction:"+",strength:5.2,level:"极小"}],salesAvg:[32e3,33e3,34e3,35e3,36e3],salesVolatilityBaseline:[{window:1,direction:"+",strength:16.2,level:"轻微"},{window:3,direction:"+",strength:13.7,level:"轻微"},{window:7,direction:"+",strength:11.5,level:"轻微"},{window:15,direction:"+",strength:9.2,level:"极小"},{window:30,direction:"+",strength:6.8,level:"极小"}],warningLevel:"正常",warningMessages:[]},{id:"SKU-2002",name:"成品 — 高端皮带",image:"https://via.placeholder.com/120?text=SKU-2002",visitorsAvg:[800,760,700,650,620],visitorsVolatilityBaseline:[{window:1,direction:"-",strength:22.5,level:"一般"},{window:3,direction:"-",strength:35.5,level:"一般"},{window:7,direction:"-",strength:25,level:"一般"},{window:15,direction:"-",strength:12.5,level:"轻微"},{window:30,direction:"-",strength:5,level:"极小"}],adCostAvg:[900,880,860,840,820],adCostVolatilityBaseline:[{window:1,direction:"-",strength:11.1,level:"轻微"},{window:3,direction:"-",strength:8.9,level:"极小"},{window:7,direction:"-",strength:6.7,level:"极小"},{window:15,direction:"-",strength:4.4,level:"极小"},{window:30,direction:"-",strength:2.2,level:"极小"}],salesAvg:[5e3,4800,4500,4200,4e3],salesVolatilityBaseline:[{window:1,direction:"-",strength:20,level:"一般"},{window:3,direction:"-",strength:30,level:"明显"},{window:7,direction:"-",strength:20,level:"一般"},{window:15,direction:"-",strength:10,level:"轻微"},{window:30,direction:"-",strength:4,level:"极小"}],warningLevel:"轻微",warningMessages:["近1/3天访客下降，建议关注"]},{id:"SKU-3003",name:"成品 — 电子秤（热销）",image:"https://via.placeholder.com/120?text=SKU-3003",visitorsAvg:[12e3,12500,13e3,13500,14e3],visitorsVolatilityBaseline:[{window:1,direction:"+",strength:16.7,level:"轻微"},{window:3,direction:"+",strength:18.7,level:"轻微"},{window:7,direction:"+",strength:12.5,level:"轻微"},{window:15,direction:"+",strength:8.3,level:"极小"},{window:30,direction:"+",strength:4.2,level:"极小"}],adCostAvg:[5e3,5200,5400,5600,5800],adCostVolatilityBaseline:[{window:1,direction:"+",strength:20,level:"一般"},{window:3,direction:"+",strength:16,level:"轻微"},{window:7,direction:"+",strength:12,level:"轻微"},{window:15,direction:"+",strength:8,level:"极小"},{window:30,direction:"+",strength:4,level:"极小"}],salesAvg:[8e4,82e3,84e3,86e3,88e3],salesVolatilityBaseline:[{window:1,direction:"+",strength:10,level:"轻微"},{window:3,direction:"+",strength:10,level:"轻微"},{window:7,direction:"+",strength:7.5,level:"极小"},{window:15,direction:"+",strength:5,level:"极小"},{window:30,direction:"+",strength:2.5,level:"极小"}],warningLevel:"一般",warningMessages:["广告费用波动较大，ROI 下降","访客数波动较大，趋势上升，变化强度45.20%，需要关注趋势变化"]},{id:"SKU-4004",name:"成品 — 夏季连衣裙",image:null,visitorsAvg:[300,280,250,220,200],visitorsVolatilityBaseline:[{window:1,direction:"-",strength:33.3,level:"明显"},{window:3,direction:"-",strength:50,level:"明显"},{window:7,direction:"-",strength:33.3,level:"明显"},{window:15,direction:"-",strength:16.7,level:"轻微"},{window:30,direction:"-",strength:6.7,level:"极小"}],adCostAvg:[50,45,40,35,30],adCostVolatilityBaseline:[{window:1,direction:"-",strength:40,level:"明显"},{window:3,direction:"-",strength:40,level:"明显"},{window:7,direction:"-",strength:30,level:"明显"},{window:15,direction:"-",strength:20,level:"一般"},{window:30,direction:"-",strength:10,level:"轻微"}],salesAvg:[1200,1100,1e3,900,800],salesVolatilityBaseline:[{window:1,direction:"-",strength:33.3,level:"明显"},{window:3,direction:"-",strength:50,level:"明显"},{window:7,direction:"-",strength:33.3,level:"明显"},{window:15,direction:"-",strength:16.7,level:"轻微"},{window:30,direction:"-",strength:8.3,level:"极小"}],warningLevel:"严重",warningMessages:["流量与转化骤降，需立刻处理","销售额波动剧烈，趋势下降，变化强度78.50%，风险较高，建议及时处理"]}]}function pe(){return G(this,null,function*(){if(!h.value){O.warning("请先选择店铺");return}c.value=!0;const s=ye("拉取数据...");try{const t=ge(h.value);if(!t)throw new Error("店铺信息不存在");const w={shopID:h.value,shopName:t.label,date:B.value};U.value&&(w.customCategory=U.value);const d=yield Pe(w);if(d.success&&d.data){if(g.value=(d.data||[]).map(r=>ve(ce({},r),{visitorsVolatilityBaseline:r.visitorsVolatilityBaseline||[],adCostVolatilityBaseline:r.adCostVolatilityBaseline||[],salesVolatilityBaseline:r.salesVolatilityBaseline||[],warningMessages:r.warningMessages||[]})),d.data&&Array.isArray(d.data)){const r=[];d.data.forEach(P=>{le.forEach(z=>{const T=P[z];typeof T=="string"&&T.trim()&&r.push(T.trim())})}),ne([...new Set(r)])}_.value=1}else throw new Error(d.error||d.message||"查询失败")}catch(t){console.error("拉取数据失败:",t),_e(),O.info("使用本地示例数据（后端接口未就绪）"),_.value=1}finally{s.close(),c.value=!1}})}function Ce(){return G(this,null,function*(){if(!h.value){O.warning("请先选择店铺");return}if(!B.value){O.warning("请先选择日期");return}R.value=!0;try{const s=ge(h.value);if(!s)throw new Error("店铺信息不存在");const t=yield ue({shopID:h.value,shopName:s.label,date:B.value});if(t.success&&t.data){const w=t.data.status;w==="new"?O.success("新增AI任务，请等待"):w==="running"?O.warning("正在执行同条件任务，请等待"):w==="exists"&&ze.confirm("已经获取AI建议，是否再次获取并覆盖之前建议？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>G(null,null,function*(){(yield ue({shopID:h.value,shopName:s.label,date:B.value})).success&&O.success("已重新获取AI建议")})).catch(()=>{})}else throw new Error(t.error||t.message||"获取AI建议失败")}catch(s){console.error("批量获取AI建议失败:",s),O.error((s==null?void 0:s.message)||"批量获取AI建议失败，请稍后重试")}finally{R.value=!1}})}function Ve(s){return s.map(t=>{var w,d,r,P,z;return typeof t=="string"?t:t&&typeof t=="object"&&(z=(P=(r=(d=(w=t.label)!=null?w:t.name)!=null?d:t.value)!=null?r:t.key)!=null?P:t.id)!=null?z:""}).map(t=>typeof t=="string"?t.trim():"").filter(Boolean)}function ne(s){if(!s.length)return;const t=new Set(b.value.map(d=>d.value));let w=!1;s.forEach(d=>{const r=d.trim();!r||t.has(r)||(b.value.push({label:r,value:r}),t.add(r),w=!0)}),w&&b.value.sort((d,r)=>d.label.localeCompare(r.label,"zh-Hans-CN"))}function oe(){return G(this,null,function*(){if(h.value)try{const s=yield We({shopID:h.value});if(s.success&&Array.isArray(s.data))ne(Ve(s.data));else throw new Error(s.error||s.message||"获取分类失败")}catch(s){console.error("获取自定义分类选项失败:",s)}})}function Be(){_.value=1}function ae(){b.value=[],U.value="",h.value&&oe(),_.value=1}return Ee(h,()=>{ae()}),Ie(()=>{h.value&&oe()}),(s,t)=>{const w=N("el-button"),d=N("el-option"),r=N("el-select"),P=N("el-date-picker"),z=N("el-icon"),T=N("el-tag"),be=N("el-card"),ke=N("el-pagination");return o(),a("div",Te,[n("div",Ge,[V(w,{type:"primary",loading:R.value,style:{"margin-right":"12px"},onClick:Ce},{default:I(()=>[...t[6]||(t[6]=[te("为每条链接获取AI建议",-1)])]),_:1},8,["loading"]),V(r,{modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=e=>h.value=e),placeholder:"选择店铺",style:{width:"200px","margin-right":"12px"},onChange:ae},{default:I(()=>[(o(!0),a(y,null,f(J(je),e=>(o(),H(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),V(P,{modelValue:B.value,"onUpdate:modelValue":t[1]||(t[1]=e=>B.value=e),type:"date",placeholder:"选择日期","value-format":"YYYY-MM-DD","disabled-date":e=>e>new Date,style:{width:"200px","margin-right":"12px"}},null,8,["modelValue","disabled-date"]),V(r,{modelValue:U.value,"onUpdate:modelValue":t[2]||(t[2]=e=>U.value=e),placeholder:"请选择自定义分类",clearable:"",filterable:"",style:{width:"220px","margin-right":"12px"},onChange:Be},{default:I(()=>[(o(!0),a(y,null,f(b.value,e=>(o(),H(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),V(w,{type:"primary",loading:c.value,icon:"el-icon-refresh",onClick:pe},{default:I(()=>[...t[7]||(t[7]=[te("拉取数据",-1)])]),_:1},8,["loading"])]),n("div",He,[(o(!0),a(y,null,f(we.value,e=>(o(),H(be,{key:e.id,class:Y(["prod-card",{"warning-severe":e.warningLevel==="严重"&&!q(e.id),"warning-normal":e.warningLevel==="一般"&&!q(e.id)}])},{default:I(()=>[n("div",$e,[n("div",{class:"expand-icon",onClick:i=>fe(e.id)},[V(z,null,{default:I(()=>[q(e.id)?(o(),H(J(Oe),{key:1})):(o(),H(J(Ne),{key:0}))]),_:2},1024)],8,qe),n("div",Je,[e.image?(o(),a("img",{key:0,src:e.image,alt:"主图",class:"prod-img"},null,8,Qe)):(o(),a("div",Xe,"无图"))]),n("div",Ze,[n("div",et,u(e.id),1),n("div",tt,u(e.name),1),n("div",lt,[V(T,{type:e.warningLevel==="严重"?"danger":e.warningLevel==="一般"?"warning":e.warningLevel==="轻微"?"info":"success"},{default:I(()=>[te(u(e.warningLevel),1)]),_:2},1032,["type"])]),e.warningMessages&&e.warningMessages.length>0?(o(),a("div",it,[(o(!0),a(y,null,f(e.warningMessages,(i,v)=>(o(),a("div",{key:v,class:"warning-message-item"},[V(z,{class:"warning-icon"},{default:I(()=>[V(J(Ue))]),_:1}),n("span",null,u(i),1)]))),128))])):$("",!0)])]),q(e.id)?(o(),a("div",st,[n("div",nt,[t[8]||(t[8]=n("div",{class:"metric-title"},"日均访客(30/15/7/3/1日)",-1)),n("div",ot,[(o(!0),a(y,null,f(e.visitorsAvg,(i,v)=>(o(),a("span",{key:v,class:Y(["metric-value","c"+v])},u(se(i)),3))),128))])]),n("div",at,[t[9]||(t[9]=n("div",{class:"metric-title"},"访客数短期波动相对长期基准(60)指标",-1)),n("div",rt,[(o(!0),a(y,null,f(X.filter(i=>i!==1),i=>{var v,k,A,x,F,S,L,M,D,E;return o(),a("span",{key:i,class:Y(["volatility-item",{"volatility-highlight":((k=(v=e.visitorsVolatilityBaseline)==null?void 0:v.find(l=>l.window===i))==null?void 0:k.level)==="明显"||((x=(A=e.visitorsVolatilityBaseline)==null?void 0:A.find(l=>l.window===i))==null?void 0:x.level)==="剧烈","volatility-subtle":((S=(F=e.visitorsVolatilityBaseline)==null?void 0:F.find(l=>l.window===i))==null?void 0:S.level)==="极小"||((M=(L=e.visitorsVolatilityBaseline)==null?void 0:L.find(l=>l.window===i))==null?void 0:M.level)==="轻微"||((E=(D=e.visitorsVolatilityBaseline)==null?void 0:D.find(l=>l.window===i))==null?void 0:E.level)==="一般"}]),style:W({borderColor:K[i],backgroundColor:K[i]+"40"})},[e.visitorsVolatilityBaseline&&e.visitorsVolatilityBaseline.find(l=>l.window===i)?(o(!0),a(y,{key:0},f(e.visitorsVolatilityBaseline.filter(l=>l.window===i),l=>(o(),a(y,{key:l.window},[n("span",dt,u(i)+"天 ",1),n("span",ct,u(l.direction==="+"?"↑":"↓"),1),n("span",vt,u(Q(l.strength))+"% ",1),n("span",{class:"volatility-level",style:W({color:"#000000",backgroundColor:Z[l.level]||"#6b7280"})}," ["+u(l.level)+"] ",5)],64))),128)):$("",!0)],6)}),128))])]),n("div",ut,[t[10]||(t[10]=n("div",{class:"metric-title"},"日均广告花费(30/15/7/3/1日)",-1)),n("div",gt,[(o(!0),a(y,null,f(e.adCostAvg,(i,v)=>(o(),a("span",{key:v,class:Y(["metric-value","c"+v])},u(se(i)),3))),128))])]),n("div",wt,[t[11]||(t[11]=n("div",{class:"metric-title"},"广告花费短期波动相对长期基准(60)指标",-1)),n("div",ht,[(o(!0),a(y,null,f(X.filter(i=>i!==1),i=>{var v,k,A,x,F,S,L,M,D,E;return o(),a("span",{key:i,class:Y(["volatility-item",{"volatility-highlight":((k=(v=e.adCostVolatilityBaseline)==null?void 0:v.find(l=>l.window===i))==null?void 0:k.level)==="明显"||((x=(A=e.adCostVolatilityBaseline)==null?void 0:A.find(l=>l.window===i))==null?void 0:x.level)==="剧烈","volatility-subtle":((S=(F=e.adCostVolatilityBaseline)==null?void 0:F.find(l=>l.window===i))==null?void 0:S.level)==="极小"||((M=(L=e.adCostVolatilityBaseline)==null?void 0:L.find(l=>l.window===i))==null?void 0:M.level)==="轻微"||((E=(D=e.adCostVolatilityBaseline)==null?void 0:D.find(l=>l.window===i))==null?void 0:E.level)==="一般"}]),style:W({borderColor:K[i],backgroundColor:K[i]+"40"})},[e.adCostVolatilityBaseline&&e.adCostVolatilityBaseline.find(l=>l.window===i)?(o(!0),a(y,{key:0},f(e.adCostVolatilityBaseline.filter(l=>l.window===i),l=>(o(),a(y,{key:l.window},[n("span",yt,u(i)+"天 ",1),n("span",ft,u(l.direction==="+"?"↑":"↓"),1),n("span",mt,u(Q(l.strength))+"% ",1),n("span",{class:"volatility-level",style:W({color:"#000000",backgroundColor:Z[l.level]||"#6b7280"})}," ["+u(l.level)+"] ",5)],64))),128)):$("",!0)],6)}),128))])]),n("div",_t,[t[12]||(t[12]=n("div",{class:"metric-title"},"日均销售额(30/15/7/3/1日)",-1)),n("div",pt,[(o(!0),a(y,null,f(e.salesAvg,(i,v)=>(o(),a("span",{key:v,class:Y(["metric-value","c"+v])},u(me(i)),3))),128))])]),n("div",Ct,[t[13]||(t[13]=n("div",{class:"metric-title"},"销售额短期波动相对长期基准(60)指标",-1)),n("div",Vt,[(o(!0),a(y,null,f(X.filter(i=>i!==1),i=>{var v,k,A,x,F,S,L,M,D,E;return o(),a("span",{key:i,class:Y(["volatility-item",{"volatility-highlight":((k=(v=e.salesVolatilityBaseline)==null?void 0:v.find(l=>l.window===i))==null?void 0:k.level)==="明显"||((x=(A=e.salesVolatilityBaseline)==null?void 0:A.find(l=>l.window===i))==null?void 0:x.level)==="剧烈","volatility-subtle":((S=(F=e.salesVolatilityBaseline)==null?void 0:F.find(l=>l.window===i))==null?void 0:S.level)==="极小"||((M=(L=e.salesVolatilityBaseline)==null?void 0:L.find(l=>l.window===i))==null?void 0:M.level)==="轻微"||((E=(D=e.salesVolatilityBaseline)==null?void 0:D.find(l=>l.window===i))==null?void 0:E.level)==="一般"}]),style:W({borderColor:K[i],backgroundColor:K[i]+"40"})},[e.salesVolatilityBaseline&&e.salesVolatilityBaseline.find(l=>l.window===i)?(o(!0),a(y,{key:0},f(e.salesVolatilityBaseline.filter(l=>l.window===i),l=>(o(),a(y,{key:l.window},[n("span",Bt,u(i)+"天 ",1),n("span",bt,u(l.direction==="+"?"↑":"↓"),1),n("span",kt,u(Q(l.strength))+"% ",1),n("span",{class:"volatility-level",style:W({color:"#FFFFFF",backgroundColor:Z[l.level]||"#6b7280"})}," ["+u(l.level)+"] ",5)],64))),128)):$("",!0)],6)}),128))])])])):$("",!0)]),_:2},1032,["class"]))),128))]),n("div",At,[V(ke,{"current-page":_.value,"onUpdate:currentPage":t[3]||(t[3]=e=>_.value=e),"page-size":p.value,"onUpdate:pageSize":t[4]||(t[4]=e=>p.value=e),"page-sizes":[10,20,50,100],total:he.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:t[5]||(t[5]=()=>_.value=1)},null,8,["current-page","page-size","total"])])])}}}),Et=Ke(xt,[["__scopeId","data-v-9bee91e0"]]);export{Et as default};
