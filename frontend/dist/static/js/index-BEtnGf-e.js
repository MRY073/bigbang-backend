var Le=Object.defineProperty,Ae=Object.defineProperties;var Ee=Object.getOwnPropertyDescriptors;var de=Object.getOwnPropertySymbols;var Ie=Object.prototype.hasOwnProperty,Me=Object.prototype.propertyIsEnumerable;var ve=(k,y,v)=>y in k?Le(k,y,{enumerable:!0,configurable:!0,writable:!0,value:v}):k[y]=v,ge=(k,y)=>{for(var v in y||(y={}))Ie.call(y,v)&&ve(k,v,y[v]);if(de)for(var v of de(y))Me.call(y,v)&&ve(k,v,y[v]);return k},ye=(k,y)=>Ae(k,Ee(y));var Q=(k,y,v)=>new Promise((_,P)=>{var W=w=>{try{x(v.next(w))}catch(b){P(b)}},j=w=>{try{x(v.throw(w))}catch(b){P(b)}},x=w=>w.done?_(w.value):Promise.resolve(w.value).then(W,j);x((v=v.apply(k,y)).next())});import{d as Ne,a as h,gr as ze,p as ae,n as Oe,m as Pe,k as n,e as i,g as o,f as m,w as V,F as f,l as C,h as F,b as fe,j as X,i as G,t as d,u as se,h4 as Ye,v as U,s as p,h5 as Ue,fJ as We,fL as me,fM as je,_ as Te}from"./index-BBIx6VGs.js";import{b as $e,c as He}from"./monitor-DtN3h8IH.js";import{a as Je}from"./productItems-CqnzHQh-.js";const Re={class:"potential-monitor-page"},qe={class:"controls"},Ge={class:"cards"},Ke={class:"card-row top"},Qe={class:"left"},Xe=["src"],Ze={key:1,class:"prod-img placeholder"},et={class:"meta"},tt={class:"id"},lt={class:"name"},at={class:"warn-row"},st={key:0,class:"warning-messages"},ot={class:"follow-area"},it={key:0,class:"follow-time"},nt={class:"metrics"},rt={class:"metric-block"},ut={class:"metric-values"},ct={class:"metric-block"},dt={class:"metric-values volatility-values"},vt={class:"metric-block"},gt={class:"metric-values"},yt={class:"metric-block"},ft={class:"metric-values volatility-values"},mt={class:"metric-block"},pt={class:"metric-values"},_t={class:"metric-block"},ht={class:"metric-values volatility-values"},Ct={class:"pagination-wrapper"},kt={key:0,style:{"text-align":"center",padding:"20px"}},bt={key:1,style:{"white-space":"pre-wrap","line-height":"1.6",color:"#303133","max-height":"400px","overflow-y":"auto"}},Vt=Ne({name:"PotentialLinkMonitor",__name:"index",setup(k){const y=h([]),v=h(!1),_=h("1489850435"),P=h(ze().format("YYYY-MM-DD")),W=h(!1),j=h(""),x=h(!1),w=h(""),b=h(1),K=h(10),oe=ae(()=>{let s=y.value;if(Y.value){const e=Y.value.trim().toLowerCase();s=s.filter(c=>ie.some(r=>{const u=c[r];return typeof u=="string"?u.toLowerCase().includes(e):!1}))}return s}),pe=ae(()=>{const s=(b.value-1)*K.value,e=s+K.value;return oe.value.slice(s,e)}),_e=ae(()=>oe.value.length),Z=[{label:"Modern Nest|泰国",value:"1489850435"},{label:"shop07|泰国",value:"1638595255"}],q=h([]),Y=h(""),ie=["custom_category_1","custom_category_2","custom_category_3","custom_category_4"];function he(s="加载中..."){return je.service({lock:!0,text:s,background:"rgba(0,0,0,0.2)"})}const T=h({});function Ce(s,e){T.value[s]||(T.value[s]={on:!1}),T.value[s].on=e,T.value[s].time=e?new Date().toLocaleString():void 0}function ee(s){var e;return!!((e=T.value[s])!=null&&e.on)}function ke(s){var e,c;return(c=(e=T.value[s])==null?void 0:e.time)!=null?c:""}function ne(s){return parseFloat(s.toFixed(2)).toString()}function be(s){return parseFloat(s.toFixed(2)).toLocaleString()}function te(s){return s==null||isNaN(s)?"0.00":s.toFixed(2)}const le=[1,3,7,15,30],B={1:"#FF6F91",3:"#FF9B6A",7:"#FFD33D",15:"#6C63FF",30:"#2DE2E6"},$={极小:"#6C63FF",轻微:"#2DE2E6",一般:"#FF9B6A",明显:"#FF6F91",剧烈:"#FF3F6C"},H={"+":"#2DE2E6","-":"#FF6F91"};function Ve(){return Q(this,null,function*(){if(!_.value){me.warning("请先选择店铺");return}v.value=!0;const s=he("拉取数据...");try{const e=Z.find(u=>u.value===_.value);if(!e)throw new Error("店铺信息不存在");const c={shopID:_.value,shopName:e.label,date:P.value};Y.value&&(c.customCategory=Y.value);const r=yield $e(c);if(r.code===200&&r.data){if(y.value=(r.data||[]).map(u=>ye(ge({},u),{visitorsVolatilityBaseline:u.visitorsVolatilityBaseline||[],adCostVolatilityBaseline:u.adCostVolatilityBaseline||[],salesVolatilityBaseline:u.salesVolatilityBaseline||[],warningMessages:u.warningMessages||[]})),r.data&&Array.isArray(r.data)){const u=[];r.data.forEach(D=>{ie.forEach(J=>{const R=D[J];typeof R=="string"&&R.trim()&&u.push(R.trim())})}),re([...new Set(u)])}b.value=1}else throw new Error(r.error||r.message||"查询失败")}catch(e){console.error("拉取数据失败:",e),b.value=1}finally{s.close(),v.value=!1}})}function we(s,e){return Q(this,null,function*(){w.value=s,W.value=!0,j.value="",x.value=!0;try{const c=Z.find(u=>u.value===_.value);if(!c)throw new Error("店铺信息不存在");const r=yield He({shopID:_.value,shopName:c.label,date:P.value,productID:s,productName:e});if(r.success&&r.data)j.value=r.data.suggestion||"暂无建议";else throw new Error(r.error||r.message||"获取AI建议失败")}catch(c){console.error("获取AI建议失败:",c),me.error((c==null?void 0:c.message)||"获取AI建议失败，请稍后重试"),j.value="获取AI建议失败，请稍后重试"}finally{x.value=!1}})}function Be(s){return s.map(e=>{var c,r,u,D,J;return typeof e=="string"?e:e&&typeof e=="object"&&(J=(D=(u=(r=(c=e.label)!=null?c:e.name)!=null?r:e.value)!=null?u:e.key)!=null?D:e.id)!=null?J:""}).map(e=>typeof e=="string"?e.trim():"").filter(Boolean)}function re(s){if(!s.length)return;const e=new Set(q.value.map(r=>r.value));let c=!1;s.forEach(r=>{const u=r.trim();!u||e.has(u)||(q.value.push({label:u,value:u}),e.add(u),c=!0)}),c&&q.value.sort((r,u)=>r.label.localeCompare(u.label,"zh-Hans-CN"))}function ue(){return Q(this,null,function*(){if(_.value)try{const s=yield Je({shopID:_.value});if(s.success&&Array.isArray(s.data))re(Be(s.data));else throw new Error(s.error||s.message||"获取分类失败")}catch(s){console.error("获取自定义分类选项失败:",s)}})}function Fe(){b.value=1}function ce(){q.value=[],Y.value="",_.value&&ue(),b.value=1}return Oe(_,()=>{ce()}),Pe(()=>{_.value&&ue()}),(s,e)=>{const c=F("el-option"),r=F("el-select"),u=F("el-date-picker"),D=F("el-button"),J=F("el-tag"),R=F("el-icon"),xe=F("el-switch"),De=F("el-card"),Se=F("el-pagination");return i(),n("div",Re,[o("div",qe,[m(r,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=t=>_.value=t),placeholder:"选择店铺",style:{width:"200px","margin-right":"12px"},onChange:ce},{default:V(()=>[(i(),n(f,null,C(Z,t=>m(c,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),m(r,{modelValue:Y.value,"onUpdate:modelValue":e[1]||(e[1]=t=>Y.value=t),placeholder:"请选择自定义分类",clearable:"",filterable:"",style:{width:"220px","margin-right":"12px"},onChange:Fe},{default:V(()=>[(i(!0),n(f,null,C(q.value,t=>(i(),fe(c,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),m(u,{modelValue:P.value,"onUpdate:modelValue":e[2]||(e[2]=t=>P.value=t),type:"date",placeholder:"选择日期","value-format":"YYYY-MM-DD","disabled-date":t=>t>new Date,style:{width:"200px","margin-right":"12px"}},null,8,["modelValue","disabled-date"]),m(D,{type:"primary",loading:v.value,icon:"el-icon-refresh",onClick:Ve},{default:V(()=>[...e[8]||(e[8]=[X("拉取数据",-1)])]),_:1},8,["loading"])]),o("div",Ge,[(i(!0),n(f,null,C(pe.value,t=>(i(),fe(De,{key:t.id,class:U(["prod-card",{"prod-followed":ee(t.id)}])},{default:V(()=>[o("div",Ke,[o("div",Qe,[t.image?(i(),n("img",{key:0,src:t.image,alt:"主图",class:"prod-img"},null,8,Xe)):(i(),n("div",Ze,"无图"))]),o("div",et,[o("div",tt,d(t.id),1),o("div",lt,d(t.name),1),o("div",at,[m(J,{type:t.warningLevel==="严重"?"danger":t.warningLevel==="一般"?"warning":t.warningLevel==="轻微"?"info":"success"},{default:V(()=>[X(d(t.warningLevel),1)]),_:2},1032,["type"])]),t.warningMessages&&t.warningMessages.length>0?(i(),n("div",st,[(i(!0),n(f,null,C(t.warningMessages,(a,g)=>(i(),n("div",{key:g,class:"warning-message-item"},[m(R,{class:"warning-icon"},{default:V(()=>[m(se(Ye))]),_:1}),o("span",null,d(a),1)]))),128))])):G("",!0)]),o("div",ot,[m(D,{type:"primary",size:"small",loading:x.value&&w.value===t.id,style:{"margin-right":"12px"},onClick:a=>we(t.id,t.name)},{default:V(()=>[...e[9]||(e[9]=[X(" 获取AI建议 ",-1)])]),_:1},8,["loading","onClick"]),m(xe,{"model-value":ee(t.id),"active-text":"已关注","inactive-text":"未关注",onChange:a=>Ce(t.id,!!a)},null,8,["model-value","onChange"]),ee(t.id)?(i(),n("div",it,d(ke(t.id)),1)):G("",!0)])]),o("div",nt,[o("div",rt,[e[10]||(e[10]=o("div",{class:"metric-title"},"日均访客(30/15/7/3/1日)",-1)),o("div",ut,[(i(!0),n(f,null,C(t.visitorsAvg,(a,g)=>(i(),n("span",{key:g,class:U(["metric-value","c"+g])},d(ne(a)),3))),128))])]),o("div",ct,[e[11]||(e[11]=o("div",{class:"metric-title"},"访客数短期波动相对长期基准(60)指标",-1)),o("div",dt,[(i(!0),n(f,null,C(le.filter(a=>a!==1),a=>{var g,S,L,A,E,I,M,N,z,O;return i(),n("span",{key:a,class:U(["volatility-item",{"volatility-highlight":((S=(g=t.visitorsVolatilityBaseline)==null?void 0:g.find(l=>l.window===a))==null?void 0:S.level)==="明显"||((A=(L=t.visitorsVolatilityBaseline)==null?void 0:L.find(l=>l.window===a))==null?void 0:A.level)==="剧烈","volatility-subtle":((I=(E=t.visitorsVolatilityBaseline)==null?void 0:E.find(l=>l.window===a))==null?void 0:I.level)==="极小"||((N=(M=t.visitorsVolatilityBaseline)==null?void 0:M.find(l=>l.window===a))==null?void 0:N.level)==="轻微"||((O=(z=t.visitorsVolatilityBaseline)==null?void 0:z.find(l=>l.window===a))==null?void 0:O.level)==="一般"}]),style:p({borderColor:B[a],backgroundColor:B[a]+"10"})},[t.visitorsVolatilityBaseline&&t.visitorsVolatilityBaseline.find(l=>l.window===a)?(i(!0),n(f,{key:0},C(t.visitorsVolatilityBaseline.filter(l=>l.window===a),l=>(i(),n(f,{key:l.window},[o("span",{class:"volatility-window",style:p({color:B[a]})},d(a)+"天 ",5),o("span",{class:"volatility-direction",style:p({color:H[l.direction]})},d(l.direction==="+"?"↑":"↓"),5),o("span",{class:"volatility-strength",style:p({color:H[l.direction]})},d(te(l.strength))+"% ",5),o("span",{class:"volatility-level",style:p({color:$[l.level],backgroundColor:($[l.level]||"#6b7280")+"20"})}," ["+d(l.level)+"] ",5)],64))),128)):G("",!0)],6)}),128))])]),o("div",vt,[e[12]||(e[12]=o("div",{class:"metric-title"},"日均广告花费(30/15/7/3/1日)",-1)),o("div",gt,[(i(!0),n(f,null,C(t.adCostAvg,(a,g)=>(i(),n("span",{key:g,class:U(["metric-value","c"+g])},d(ne(a)),3))),128))])]),o("div",yt,[e[13]||(e[13]=o("div",{class:"metric-title"},"广告花费短期波动相对长期基准(60)指标",-1)),o("div",ft,[(i(!0),n(f,null,C(le.filter(a=>a!==1),a=>{var g,S,L,A,E,I,M,N,z,O;return i(),n("span",{key:a,class:U(["volatility-item",{"volatility-highlight":((S=(g=t.adCostVolatilityBaseline)==null?void 0:g.find(l=>l.window===a))==null?void 0:S.level)==="明显"||((A=(L=t.adCostVolatilityBaseline)==null?void 0:L.find(l=>l.window===a))==null?void 0:A.level)==="剧烈","volatility-subtle":((I=(E=t.adCostVolatilityBaseline)==null?void 0:E.find(l=>l.window===a))==null?void 0:I.level)==="极小"||((N=(M=t.adCostVolatilityBaseline)==null?void 0:M.find(l=>l.window===a))==null?void 0:N.level)==="轻微"||((O=(z=t.adCostVolatilityBaseline)==null?void 0:z.find(l=>l.window===a))==null?void 0:O.level)==="一般"}]),style:p({borderColor:B[a],backgroundColor:B[a]+"10"})},[t.adCostVolatilityBaseline&&t.adCostVolatilityBaseline.find(l=>l.window===a)?(i(!0),n(f,{key:0},C(t.adCostVolatilityBaseline.filter(l=>l.window===a),l=>(i(),n(f,{key:l.window},[o("span",{class:"volatility-window",style:p({color:B[a]})},d(a)+"天 ",5),o("span",{class:"volatility-direction",style:p({color:H[l.direction]})},d(l.direction==="+"?"↑":"↓"),5),o("span",{class:"volatility-strength",style:p({color:H[l.direction]})},d(te(l.strength))+"% ",5),o("span",{class:"volatility-level",style:p({color:$[l.level],backgroundColor:($[l.level]||"#6b7280")+"20"})}," ["+d(l.level)+"] ",5)],64))),128)):G("",!0)],6)}),128))])]),o("div",mt,[e[14]||(e[14]=o("div",{class:"metric-title"},"日均销售额(30/15/7/3/1日)",-1)),o("div",pt,[(i(!0),n(f,null,C(t.salesAvg,(a,g)=>(i(),n("span",{key:g,class:U(["metric-value","c"+g])},d(be(a)),3))),128))])]),o("div",_t,[e[15]||(e[15]=o("div",{class:"metric-title"},"销售额短期波动相对长期基准(60)指标",-1)),o("div",ht,[(i(!0),n(f,null,C(le.filter(a=>a!==1),a=>{var g,S,L,A,E,I,M,N,z,O;return i(),n("span",{key:a,class:U(["volatility-item",{"volatility-highlight":((S=(g=t.salesVolatilityBaseline)==null?void 0:g.find(l=>l.window===a))==null?void 0:S.level)==="明显"||((A=(L=t.salesVolatilityBaseline)==null?void 0:L.find(l=>l.window===a))==null?void 0:A.level)==="剧烈","volatility-subtle":((I=(E=t.salesVolatilityBaseline)==null?void 0:E.find(l=>l.window===a))==null?void 0:I.level)==="极小"||((N=(M=t.salesVolatilityBaseline)==null?void 0:M.find(l=>l.window===a))==null?void 0:N.level)==="轻微"||((O=(z=t.salesVolatilityBaseline)==null?void 0:z.find(l=>l.window===a))==null?void 0:O.level)==="一般"}]),style:p({borderColor:B[a],backgroundColor:B[a]+"10"})},[t.salesVolatilityBaseline&&t.salesVolatilityBaseline.find(l=>l.window===a)?(i(!0),n(f,{key:0},C(t.salesVolatilityBaseline.filter(l=>l.window===a),l=>(i(),n(f,{key:l.window},[o("span",{class:"volatility-window",style:p({color:B[a]})},d(a)+"天 ",5),o("span",{class:"volatility-direction",style:p({color:H[l.direction]})},d(l.direction==="+"?"↑":"↓"),5),o("span",{class:"volatility-strength",style:p({color:H[l.direction]})},d(te(l.strength))+"% ",5),o("span",{class:"volatility-level",style:p({color:$[l.level],backgroundColor:($[l.level]||"#6b7280")+"20"})}," ["+d(l.level)+"] ",5)],64))),128)):G("",!0)],6)}),128))])])])]),_:2},1032,["class"]))),128))]),o("div",Ct,[m(Se,{"current-page":b.value,"onUpdate:currentPage":e[3]||(e[3]=t=>b.value=t),"page-size":K.value,"onUpdate:pageSize":e[4]||(e[4]=t=>K.value=t),"page-sizes":[10,20,50,100],total:_e.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:e[5]||(e[5]=()=>b.value=1)},null,8,["current-page","page-size","total"])]),m(se(We),{modelValue:W.value,"onUpdate:modelValue":e[7]||(e[7]=t=>W.value=t),title:"AI建议",width:"600px","close-on-click-modal":!1},{footer:V(()=>[m(D,{onClick:e[6]||(e[6]=t=>W.value=!1)},{default:V(()=>[...e[17]||(e[17]=[X("关闭",-1)])]),_:1})]),default:V(()=>[x.value?(i(),n("div",kt,[m(R,{class:"is-loading",style:{"font-size":"24px"}},{default:V(()=>[m(se(Ue))]),_:1}),e[16]||(e[16]=o("p",{style:{"margin-top":"10px"}},"AI正在分析中...",-1))])):(i(),n("div",bt,d(j.value||"暂无建议"),1))]),_:1},8,["modelValue"])])}}}),Dt=Te(Vt,[["__scopeId","data-v-a102e84c"]]);export{Dt as default};
