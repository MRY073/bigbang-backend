var w=(U,u,g)=>new Promise((x,f)=>{var h=d=>{try{p(g.next(d))}catch(s){f(s)}},P=d=>{try{p(g.throw(d))}catch(s){f(s)}},p=d=>d.done?x(d.value):Promise.resolve(d.value).then(h,P);p((g=g.apply(U,u)).next())});import{d as oe,a as o,M as ne,p as se,m as re,k as b,e as n,f as r,w as c,g as i,i as L,b as k,h as v,F as $,l as F,u as ce,j as N,A as ie,B as ue,q as j,t as K,fL as m,h6 as q,fM as de,_ as pe}from"./index-DG9AC6Fl.js";import{c as ve,d as me,e as ge,g as _e}from"./productItems-CaFZYQ76.js";import{s as fe,g as he,D as ye}from"./shops-B4eWs2OP.js";const Ce={class:"offline-products-page"},we={class:"card-header"},be={class:"left"},ke={class:"filters"},xe={class:"actions"},Ve={class:"table-wrapper"},Pe={class:"cell-center"},ze=["onClick"],De={class:"cell-center"},Se=["onClick"],Be={class:"cell-center"},Ee=["src"],Le={key:1,class:"no-img"},Oe={class:"online-actions"},Te={key:0,class:"pagination-wrapper"},Me=oe({name:"OfflineProducts",__name:"index",setup(U){const u=o(ye),g=ne([]),x=o(""),f=o(""),h=o(""),P=o([]),p=o(!1),d=se(()=>{const a=x.value.trim(),e=f.value.trim().toLowerCase();return g.value.filter(l=>{var C,_;const B=!a||((C=l.product_id)!=null?C:"").toLowerCase().includes(a.toLowerCase()),E=!e||((_=l.product_name)!=null?_:"").toLowerCase().includes(e);return B&&E})}),s=o(1),z=o(20),H=[10,20,50,100,200],V=o(0),O=o({}),D=o({}),T=o({}),S=o({});function R(a="加载中..."){return de.service({lock:!0,text:a,background:"rgba(0,0,0,0.2)"})}function y(){return w(this,null,function*(){if(!u.value){m.warning("请先选择店铺");return}D.value={},S.value={},p.value=!0;const a=R("拉取数据中...");try{const e=he(u.value);if(!e)throw new Error("店铺信息不存在");const l=yield ve({shopID:u.value,shopName:e.label,page:s.value,pageSize:z.value,customCategory:h.value||void 0});if(l.success&&Array.isArray(l.data))g.value=l.data,V.value=l.total||l.data.length,m.success(l.message||`数据拉取成功，共 ${V.value} 条`);else throw new Error(l.error||l.message||"查询失败")}catch(e){console.error("拉取数据失败:",e),m.error((e==null?void 0:e.message)||"网络连接失败，请检查网络后重试"),g.value=[],V.value=0}finally{a.close(),p.value=!1}})}function G(a){return w(this,null,function*(){try{yield q.confirm("确定要上架该商品吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),O.value[a]=!0;try{const e=yield me(a,0);if(e.success)D.value[a]=!0,m.success(e.message||"上架成功");else throw new Error(e.error||e.message||"上架失败")}catch(e){console.error("上架商品失败:",e),m.error((e==null?void 0:e.message)||"上架失败，请检查网络后重试")}finally{delete O.value[a]}}catch(e){}})}function J(a){return w(this,null,function*(){try{yield q.confirm("确定要删除该商品吗？此操作不可恢复！","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),T.value[a]=!0;try{const e=yield ge(a);if(e.success)S.value[a]=!0,m.success(e.message||"删除成功");else throw new Error(e.error||e.message||"删除失败")}catch(e){console.error("删除商品失败:",e),m.error((e==null?void 0:e.message)||"删除失败，请检查网络后重试")}finally{delete T.value[a]}}catch(e){}})}function Q(a){s.value=a,y()}function W(a){z.value=a,s.value=1,y()}function A(a){return w(this,null,function*(){try{if(navigator.clipboard&&navigator.clipboard.writeText)yield navigator.clipboard.writeText(a);else{const e=document.createElement("textarea");e.value=a,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}m.success("已复制到剪贴板")}catch(e){m.error("复制失败")}})}function X(){s.value=1,h.value="",D.value={},S.value={},I(),y()}function I(){return w(this,null,function*(){if(u.value)try{const a=yield _e({shopID:u.value});a.success&&Array.isArray(a.data)&&(P.value=a.data)}catch(a){console.error("加载自定义分类选项失败:",a)}})}function Y(){s.value=1,y()}return re(()=>{u.value&&(I(),y())}),(a,e)=>{const l=v("el-option"),B=v("el-select"),E=v("el-input"),C=v("el-button"),_=v("el-table-column"),Z=v("el-table"),ee=v("el-pagination"),te=v("el-empty"),ae=v("el-card"),le=ue("loading");return n(),b("div",Ce,[r(ae,{class:"products-card"},{default:c(()=>[i("div",we,[i("div",be,[r(B,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=t=>u.value=t),placeholder:"选择店铺",style:{width:"200px"},onChange:X},{default:c(()=>[(n(!0),b($,null,F(ce(fe),t=>(n(),k(l,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),i("div",ke,[r(B,{modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=t=>h.value=t),placeholder:"选择自定义分类",clearable:"",style:{width:"200px"},onChange:Y},{default:c(()=>[(n(!0),b($,null,F(P.value,t=>(n(),k(l,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),r(E,{modelValue:x.value,"onUpdate:modelValue":e[2]||(e[2]=t=>x.value=t),placeholder:"输入商品ID搜索",clearable:"",class:"filter-input"},null,8,["modelValue"]),r(E,{modelValue:f.value,"onUpdate:modelValue":e[3]||(e[3]=t=>f.value=t),placeholder:"输入商品名称搜索（模糊）",clearable:"",class:"filter-input"},null,8,["modelValue"])])]),i("div",xe,[r(C,{type:"primary",loading:p.value,icon:"el-icon-refresh",onClick:y},{default:c(()=>[...e[6]||(e[6]=[N("拉取数据",-1)])]),_:1},8,["loading"])])]),i("div",Ve,[ie((n(),k(Z,{data:d.value,stripe:"",style:{width:"100%"},"row-key":t=>t.product_id,"max-height":600},{default:c(()=>[r(_,{prop:"product_id",label:"商品ID",width:"200",align:"center","header-align":"center",fixed:"left"},{default:c(({row:t})=>[i("div",Pe,[i("span",{class:"plain-text",title:"点击复制",onClick:j(M=>A(t.product_id),["stop"])},K(t.product_id),9,ze)])]),_:1}),r(_,{prop:"product_name",label:"商品名称","min-width":"300",align:"center","header-align":"center",fixed:"left"},{default:c(({row:t})=>[i("div",De,[i("span",{class:"plain-text",title:"点击复制",onClick:j(M=>A(t.product_name),["stop"])},K(t.product_name),9,Se)])]),_:1}),r(_,{prop:"product_image",label:"商品主图",width:"120",align:"center","header-align":"center",fixed:"left"},{default:c(({row:t})=>[i("div",Be,[t.product_image?(n(),b("img",{key:0,src:t.product_image,alt:"主图",class:"thumb"},null,8,Ee)):(n(),b("div",Le,"无图"))])]),_:1}),r(_,{label:"操作",width:"180",align:"center","header-align":"center",fixed:"right"},{default:c(({row:t})=>[i("div",Oe,[D.value[t.product_id]?L("",!0):(n(),k(C,{key:0,type:"success",size:"small",loading:O.value[t.product_id],onClick:M=>G(t.product_id)},{default:c(()=>[...e[7]||(e[7]=[N("上架",-1)])]),_:1},8,["loading","onClick"])),S.value[t.product_id]?L("",!0):(n(),k(C,{key:1,type:"danger",size:"small",loading:T.value[t.product_id],onClick:M=>J(t.product_id)},{default:c(()=>[...e[8]||(e[8]=[N("删除",-1)])]),_:1},8,["loading","onClick"]))])]),_:1})]),_:1},8,["data","row-key"])),[[le,p.value]])]),V.value>0?(n(),b("div",Te,[r(ee,{"current-page":s.value,"onUpdate:currentPage":e[4]||(e[4]=t=>s.value=t),"page-size":z.value,"onUpdate:pageSize":e[5]||(e[5]=t=>z.value=t),"page-sizes":H,total:V.value,background:!0,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:Q,onSizeChange:W},null,8,["current-page","page-size","total"])])):L("",!0),!p.value&&d.value.length===0?(n(),k(te,{key:1,description:"暂无已下架商品"})):L("",!0)]),_:1})])}}}),$e=pe(Me,[["__scopeId","data-v-67277831"]]);export{$e as default};
