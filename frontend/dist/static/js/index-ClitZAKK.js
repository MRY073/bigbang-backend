var x=(O,d,u)=>new Promise((_,S)=>{var T=c=>{try{v(u.next(c))}catch(h){S(h)}},k=c=>{try{v(u.throw(c))}catch(h){S(h)}},v=c=>c.done?_(c.value):Promise.resolve(c.value).then(T,k);v((u=u.apply(O,d)).next())});import{a as P}from"./products-DrRGqIQT.js";import{s as F,g as z,D as j}from"./shops-B4eWs2OP.js";import{d as Y,a as I,k as g,e as l,g as r,b as D,f as U,w,F as $,l as K,h as y,u as q,j as C,v as G,i as b,t as f,fL as m,fM as J,_ as Q}from"./index-BTtCWf6Z.js";const R={class:"trial-monitor-page"},W={class:"controls"},X={key:1,class:"grid"},Z={class:"card-top"},tt={class:"img-area"},et=["src"],st={key:1,class:"thumb placeholder"},at={class:"info-area"},ot=["onClick"],nt=["title"],rt={class:"tags"},it={class:"card-metrics"},ct={class:"metric"},lt={class:"value"},dt={class:"metric"},ut={class:"value"},_t={class:"metric"},gt={class:"value"},pt={class:"card-foot"},mt={key:0,class:"hint"},ft=Y({name:"TrialLinkMonitor",__name:"index",setup(O){const d=I([]),u=I(!1),_=I(j);function S(e="加载中..."){return J.service({lock:!0,text:e,background:"rgba(0,0,0,0.2)"})}function T(e){return e.toLocaleString("zh-CN")}function k(e){if(!e)return"未设置";try{const t=e.match(/^(\d{4})-(\d{2})-(\d{2})/);if(t){const o=parseInt(t[1],10),s=parseInt(t[2],10),i=parseInt(t[3],10);if(o>=1900&&o<=2100&&s>=1&&s<=12&&i>=1&&i<=31)return`${o}-${String(s).padStart(2,"0")}-${String(i).padStart(2,"0")}`}const a=new Date(e);if(!isNaN(a.getTime())){const o=a.getFullYear(),s=String(a.getMonth()+1).padStart(2,"0"),i=String(a.getDate()).padStart(2,"0");return`${o}-${s}-${i}`}return"日期格式错误"}catch(t){return"日期格式错误"}}function v(e){if(!e)return!1;try{const t=e.match(/^(\d{4})-(\d{2})-(\d{2})/);if(!t)return!1;const a=parseInt(t[1],10),o=parseInt(t[2],10)-1,s=parseInt(t[3],10),i=new Date(a,o,s),p=new Date;p.setHours(0,0,0,0),i.setHours(0,0,0,0);const n=p.getTime()-i.getTime();return Math.floor(n/(1e3*60*60*24))>=15}catch(t){return!1}}function c(e){const t=e.total_visitors,a=e.total_orders,o=v(e.testing_stage_start);return t>100||a>6||o?"finished":t>=50&&t<=100||a>=3&&a<=6?"watching":"normal"}function h(e){const t=c(e);return t==="finished"?"card-status-finished":t==="watching"?"card-status-watching":"card-status-normal"}function E(e){const t=c(e);return t==="finished"?"测款已完成，需马上处理":t==="watching"?"数据优秀情况下及时转为潜力款，需尽快处理":""}function N(e){return e==="finished"?1:e==="watching"?2:3}function M(e){return[...e].sort((t,a)=>{const o=c(t),s=c(a);return N(o)-N(s)})}function L(){const e=new Date,t=new Date(e);t.setDate(e.getDate()-20);const a=new Date(e);a.setDate(e.getDate()-10);const o=new Date(e);o.setDate(e.getDate()-5),d.value=[{product_id:"SKU-T1001",product_name:"测款 — 轻便跑鞋",product_image:"https://via.placeholder.com/160?text=T1001",testing_stage_start:t.toISOString().split("T")[0],total_orders:2,total_visitors:60},{product_id:"SKU-T1002",product_name:"测款 — 多功能杯",product_image:"https://via.placeholder.com/160?text=T1002",testing_stage_start:a.toISOString().split("T")[0],total_orders:7,total_visitors:85},{product_id:"SKU-T1003",product_name:"测款 — 智能照明灯",product_image:"https://via.placeholder.com/160?text=T1003",testing_stage_start:o.toISOString().split("T")[0],total_orders:4,total_visitors:120},{product_id:"SKU-T1004",product_name:"测款 — 创意手机支架",product_image:null,testing_stage_start:o.toISOString().split("T")[0],total_orders:5,total_visitors:75},{product_id:"SKU-T1005",product_name:"测款 — 多彩背包",product_image:"https://via.placeholder.com/160?text=T1005",testing_stage_start:a.toISOString().split("T")[0],total_orders:1,total_visitors:65},{product_id:"SKU-T1006",product_name:"测款 — 简约水杯",product_image:"https://via.placeholder.com/160?text=T1006",testing_stage_start:o.toISOString().split("T")[0],total_orders:0,total_visitors:30},{product_id:"SKU-T1007",product_name:"测款 — 运动手环",product_image:"https://via.placeholder.com/160?text=T1007",testing_stage_start:a.toISOString().split("T")[0],total_orders:2,total_visitors:45}]}function V(){return x(this,null,function*(){var t,a,o;if(!_.value){m.warning("请先选择店铺");return}u.value=!0;const e=S("拉取数据中...");try{const s=z(_.value);if(!s)throw new Error("店铺信息不存在");const i=yield P({shopID:_.value,shopName:s.label});if(i.success&&i.data){const p=i.data;d.value=M(p),d.value.length===0?m.info("当前店铺暂无测款商品"):m.success(i.message||`查询成功，共 ${d.value.length} 条数据`)}else throw new Error(i.error||i.message||"查询失败")}catch(s){console.error("拉取数据失败:",s),(t=s==null?void 0:s.message)!=null&&t.includes("HTTP error")||(a=s==null?void 0:s.message)!=null&&a.includes("fetch")||(o=s==null?void 0:s.message)!=null&&o.includes("Network")?(L(),d.value=M(d.value),m.info("使用本地示例数据（后端不可用）")):(m.error((s==null?void 0:s.message)||"网络连接失败，请检查网络后重试"),d.value=[])}finally{e.close(),u.value=!1}})}function B(e){var o;const t=e.target;t.style.display="none";const a=document.createElement("div");a.className="thumb placeholder",a.textContent="无图",(o=t.parentElement)==null||o.appendChild(a)}function A(e){return x(this,null,function*(){try{if(navigator.clipboard&&navigator.clipboard.writeText)yield navigator.clipboard.writeText(e);else{const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}m.success("已复制到剪贴板")}catch(t){m.error("复制失败")}})}return(e,t)=>{const a=y("el-option"),o=y("el-select"),s=y("el-button"),i=y("el-empty"),p=y("el-tag");return l(),g("div",R,[r("div",W,[U(o,{modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=n=>_.value=n),placeholder:"选择店铺",style:{width:"200px","margin-right":"12px"}},{default:w(()=>[(l(!0),g($,null,K(q(F),n=>(l(),D(a,{key:n.value,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),U(s,{type:"primary",loading:u.value,icon:"el-icon-refresh",onClick:V},{default:w(()=>[...t[1]||(t[1]=[C("拉取数据",-1)])]),_:1},8,["loading"])]),!u.value&&d.value.length===0&&_.value?(l(),D(i,{key:0,description:"当前店铺暂无测款商品","image-size":120})):(l(),g("div",X,[(l(!0),g($,null,K(d.value,n=>(l(),g("div",{key:n.product_id,class:G(["prod-card",h(n)])},[r("div",Z,[r("div",tt,[n.product_image?(l(),g("img",{key:0,src:n.product_image,alt:"主图",class:"thumb",onError:B},null,40,et)):b("",!0),n.product_image?b("",!0):(l(),g("div",st,"无图"))]),r("div",at,[r("div",{class:"id",title:"点击复制ID",onClick:H=>A(n.product_id)},f(n.product_id),9,ot),r("div",{class:"name",title:n.product_name},f(n.product_name),9,nt),r("div",rt,[c(n)==="finished"?(l(),D(p,{key:0,type:"danger"},{default:w(()=>[...t[2]||(t[2]=[C("测款完毕",-1)])]),_:1})):c(n)==="watching"?(l(),D(p,{key:1,type:"warning"},{default:w(()=>[...t[3]||(t[3]=[C("测款关注中",-1)])]),_:1})):b("",!0)])])]),r("div",it,[r("div",ct,[t[4]||(t[4]=r("div",{class:"label"},"测款日期开始",-1)),r("div",lt,f(k(n.testing_stage_start)),1)]),r("div",dt,[t[5]||(t[5]=r("div",{class:"label"},"出单数",-1)),r("div",ut,f(T(n.total_orders)),1)]),r("div",_t,[t[6]||(t[6]=r("div",{class:"label"},"累计访客",-1)),r("div",gt,f(T(n.total_visitors)),1)])]),r("div",pt,[E(n)?(l(),g("div",mt,f(E(n)),1)):b("",!0)])],2))),128))]))])}}}),Tt=Q(ft,[["__scopeId","data-v-f70955b9"]]);export{Tt as default};
