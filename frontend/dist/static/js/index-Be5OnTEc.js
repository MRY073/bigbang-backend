var Be=Object.defineProperty,Fe=Object.defineProperties;var xe=Object.getOwnPropertyDescriptors;var re=Object.getOwnPropertySymbols;var Ae=Object.prototype.hasOwnProperty,Le=Object.prototype.propertyIsEnumerable;var ce=(_,v,u)=>v in _?Be(_,v,{enumerable:!0,configurable:!0,writable:!0,value:u}):_[v]=u,ue=(_,v)=>{for(var u in v||(v={}))Ae.call(v,u)&&ce(_,u,v[u]);if(re)for(var u of re(v))Le.call(v,u)&&ce(_,u,v[u]);return _},de=(_,v)=>Fe(_,xe(v));var q=(_,v,u)=>new Promise((f,k)=>{var T=h=>{try{p(u.next(h))}catch(P){k(P)}},R=h=>{try{p(u.throw(h))}catch(P){k(P)}},p=h=>h.done?f(h.value):Promise.resolve(h.value).then(T,R);p((u=u.apply(_,v)).next())});import{d as De,a as b,gq as Se,p as ee,n as Ee,m as Ie,k as r,e as i,g as o,f as E,w as O,j as te,h as I,F as m,l as C,b as J,u as le,i as K,h2 as Ne,h3 as Oe,t as d,v as M,s as j,fJ as z,h5 as Me,fL as ze,_ as Pe}from"./index-BuOtfv0u.js";import{a as Ye,c as ve}from"./monitor-hES8Gj77.js";import{g as Ue}from"./productItems-C3l-b8Tu.js";import{s as We,g as ye,D as je}from"./shops-B4eWs2OP.js";const Te={class:"potential-monitor-page"},Re={class:"controls"},Ge={class:"cards"},He={class:"card-row top"},qe=["onClick"],Je={class:"left"},$e=["src"],Ke={key:1,class:"prod-img placeholder"},Qe={class:"meta"},Xe={class:"id"},Ze={class:"name"},et={class:"warn-row"},tt={key:0,class:"metrics"},lt={class:"metric-block"},at={class:"metric-values"},st={class:"metric-block"},ot={class:"metric-values volatility-values"},it={class:"volatility-window",style:{color:"#000000"}},nt={class:"volatility-direction",style:{color:"#000000"}},rt={class:"volatility-strength",style:{color:"#000000"}},ct={class:"metric-block"},ut={class:"metric-values"},dt={class:"metric-block"},vt={class:"metric-values volatility-values"},yt={class:"volatility-window",style:{color:"#000000"}},gt={class:"volatility-direction",style:{color:"#000000"}},ft={class:"volatility-strength",style:{color:"#000000"}},mt={class:"metric-block"},_t={class:"metric-values"},pt={class:"metric-block"},ht={class:"metric-values volatility-values"},Ct={class:"volatility-window",style:{color:"#000000"}},bt={class:"volatility-direction",style:{color:"#000000"}},kt={class:"volatility-strength",style:{color:"#000000"}},wt={class:"pagination-wrapper"},Vt=De({name:"PotentialLinkMonitor",__name:"index",setup(_){const v=b([]),u=b(!1),f=b(je),k=b(Se().format("YYYY-MM-DD")),T=b({}),R=b(!1),p=b(1),h=b(10),P=ee(()=>{let s=v.value;if(N.value){const t=N.value.trim().toLowerCase();s=s.filter(y=>ae.some(c=>{const n=y[c];return typeof n=="string"?n.toLowerCase().includes(t):!1}))}return s}),ge=ee(()=>{const s=(p.value-1)*h.value,t=s+h.value;return P.value.slice(s,t)}),fe=ee(()=>P.value.length),G=b([]),N=b(""),ae=["custom_category_1","custom_category_2","custom_category_3","custom_category_4"];function me(s="加载中..."){return ze.service({lock:!0,text:s,background:"rgba(0,0,0,0.2)"})}function _e(s){T.value[s]=!T.value[s]}function $(s){return!!T.value[s]}function se(s){return parseFloat(s.toFixed(2)).toString()}function pe(s){return parseFloat(s.toFixed(2)).toLocaleString()}function Q(s){return s==null||isNaN(s)?"0.00":s.toFixed(2)}const X=[1,3,7,15,30],Y={1:"#FF6F91",3:"#FF9B6A",7:"#FFD33D",15:"#4A00E0",30:"#0066CC"},Z={极小:"#6C63FF",轻微:"#2DE2E6",一般:"#FF9B6A",明显:"#FF6F91",剧烈:"#FF3F6C"};function he(){return q(this,null,function*(){if(!f.value){z.warning("请先选择店铺");return}u.value=!0;const s=me("拉取数据...");try{const t=ye(f.value);if(!t)throw new Error("店铺信息不存在");const y={shopID:f.value,shopName:t.label,date:k.value};N.value&&(y.customCategory=N.value);const c=yield Ye(y);if(c.code===200&&c.data){if(v.value=(c.data||[]).map(n=>de(ue({},n),{visitorsVolatilityBaseline:n.visitorsVolatilityBaseline||[],adCostVolatilityBaseline:n.adCostVolatilityBaseline||[],salesVolatilityBaseline:n.salesVolatilityBaseline||[],warningMessages:n.warningMessages||[]})),c.data&&Array.isArray(c.data)){const n=[];c.data.forEach(U=>{ae.forEach(W=>{const H=U[W];typeof H=="string"&&H.trim()&&n.push(H.trim())})}),oe([...new Set(n)])}p.value=1}else throw new Error(c.error||c.message||"查询失败")}catch(t){console.error("拉取数据失败:",t),p.value=1}finally{s.close(),u.value=!1}})}function Ce(){return q(this,null,function*(){if(!f.value){z.warning("请先选择店铺");return}if(!k.value){z.warning("请先选择日期");return}R.value=!0;try{const s=ye(f.value);if(!s)throw new Error("店铺信息不存在");const t=yield ve({shopID:f.value,shopName:s.label,date:k.value});if(t.success&&t.data){const y=t.data.status;y==="new"?z.success("新增AI任务，请等待"):y==="running"?z.warning("正在执行同条件任务，请等待"):y==="exists"&&Me.confirm("已经获取AI建议，是否再次获取并覆盖之前建议？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>q(null,null,function*(){(yield ve({shopID:f.value,shopName:s.label,date:k.value})).success&&z.success("已重新获取AI建议")})).catch(()=>{})}else throw new Error(t.error||t.message||"获取AI建议失败")}catch(s){console.error("批量获取AI建议失败:",s),z.error((s==null?void 0:s.message)||"批量获取AI建议失败，请稍后重试")}finally{R.value=!1}})}function be(s){return s.map(t=>{var y,c,n,U,W;return typeof t=="string"?t:t&&typeof t=="object"&&(W=(U=(n=(c=(y=t.label)!=null?y:t.name)!=null?c:t.value)!=null?n:t.key)!=null?U:t.id)!=null?W:""}).map(t=>typeof t=="string"?t.trim():"").filter(Boolean)}function oe(s){if(!s.length)return;const t=new Set(G.value.map(c=>c.value));let y=!1;s.forEach(c=>{const n=c.trim();!n||t.has(n)||(G.value.push({label:n,value:n}),t.add(n),y=!0)}),y&&G.value.sort((c,n)=>c.label.localeCompare(n.label,"zh-Hans-CN"))}function ie(){return q(this,null,function*(){if(f.value)try{const s=yield Ue({shopID:f.value});if(s.success&&Array.isArray(s.data))oe(be(s.data));else throw new Error(s.error||s.message||"获取分类失败")}catch(s){console.error("获取自定义分类选项失败:",s)}})}function ke(){p.value=1}function ne(){G.value=[],N.value="",f.value&&ie(),p.value=1}return Ee(f,()=>{ne()}),Ie(()=>{f.value&&ie()}),(s,t)=>{const y=I("el-button"),c=I("el-option"),n=I("el-select"),U=I("el-date-picker"),W=I("el-icon"),H=I("el-tag"),we=I("el-card"),Ve=I("el-pagination");return i(),r("div",Te,[o("div",Re,[E(y,{type:"primary",loading:R.value,style:{"margin-right":"12px"},onClick:Ce},{default:O(()=>[...t[6]||(t[6]=[te("为每条链接获取AI建议",-1)])]),_:1},8,["loading"]),E(n,{modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=e=>f.value=e),placeholder:"选择店铺",style:{width:"200px","margin-right":"12px"},onChange:ne},{default:O(()=>[(i(!0),r(m,null,C(le(We),e=>(i(),J(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),E(U,{modelValue:k.value,"onUpdate:modelValue":t[1]||(t[1]=e=>k.value=e),type:"date",placeholder:"选择日期","value-format":"YYYY-MM-DD","disabled-date":e=>e>new Date,style:{width:"200px","margin-right":"12px"}},null,8,["modelValue","disabled-date"]),E(n,{modelValue:N.value,"onUpdate:modelValue":t[2]||(t[2]=e=>N.value=e),placeholder:"请选择自定义分类",clearable:"",filterable:"",style:{width:"220px","margin-right":"12px"},onChange:ke},{default:O(()=>[(i(!0),r(m,null,C(G.value,e=>(i(),J(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),E(y,{type:"primary",loading:u.value,icon:"el-icon-refresh",onClick:he},{default:O(()=>[...t[7]||(t[7]=[te("拉取数据",-1)])]),_:1},8,["loading"])]),o("div",Ge,[(i(!0),r(m,null,C(ge.value,e=>(i(),J(we,{key:e.id,class:M(["prod-card",{"warning-severe":e.warningLevel==="严重"&&!$(e.id),"warning-normal":e.warningLevel==="一般"&&!$(e.id)}])},{default:O(()=>[o("div",He,[o("div",{class:"expand-icon",onClick:a=>_e(e.id)},[E(W,null,{default:O(()=>[$(e.id)?(i(),J(le(Oe),{key:1})):(i(),J(le(Ne),{key:0}))]),_:2},1024)],8,qe),o("div",Je,[e.image?(i(),r("img",{key:0,src:e.image,alt:"主图",class:"prod-img"},null,8,$e)):(i(),r("div",Ke,"无图"))]),o("div",Qe,[o("div",Xe,d(e.id),1),o("div",Ze,d(e.name),1),o("div",et,[E(H,{type:e.warningLevel==="严重"?"danger":e.warningLevel==="一般"?"warning":e.warningLevel==="轻微"?"info":"success",class:"warning-level-tag"},{default:O(()=>[te(d(e.warningLevel),1)]),_:2},1032,["type"])])])]),$(e.id)?(i(),r("div",tt,[o("div",lt,[t[8]||(t[8]=o("div",{class:"metric-title"},"日均访客(30/15/7/3/1日)",-1)),o("div",at,[(i(!0),r(m,null,C(e.visitorsAvg,(a,g)=>(i(),r("span",{key:g,class:M(["metric-value","c"+g])},d(se(a)),3))),128))])]),o("div",st,[t[9]||(t[9]=o("div",{class:"metric-title"},"访客数短期波动相对长期基准(60)指标",-1)),o("div",ot,[(i(!0),r(m,null,C(X.filter(a=>a!==1),a=>{var g,w,V,B,F,x,A,L,D,S;return i(),r("span",{key:a,class:M(["volatility-item",{"volatility-highlight":((w=(g=e.visitorsVolatilityBaseline)==null?void 0:g.find(l=>l.window===a))==null?void 0:w.level)==="明显"||((B=(V=e.visitorsVolatilityBaseline)==null?void 0:V.find(l=>l.window===a))==null?void 0:B.level)==="剧烈","volatility-subtle":((x=(F=e.visitorsVolatilityBaseline)==null?void 0:F.find(l=>l.window===a))==null?void 0:x.level)==="极小"||((L=(A=e.visitorsVolatilityBaseline)==null?void 0:A.find(l=>l.window===a))==null?void 0:L.level)==="轻微"||((S=(D=e.visitorsVolatilityBaseline)==null?void 0:D.find(l=>l.window===a))==null?void 0:S.level)==="一般"}]),style:j({borderColor:Y[a],backgroundColor:Y[a]+"40"})},[e.visitorsVolatilityBaseline&&e.visitorsVolatilityBaseline.find(l=>l.window===a)?(i(!0),r(m,{key:0},C(e.visitorsVolatilityBaseline.filter(l=>l.window===a),l=>(i(),r(m,{key:l.window},[o("span",it,d(a)+"天 ",1),o("span",nt,d(l.direction==="+"?"↑":"↓"),1),o("span",rt,d(Q(l.strength))+"% ",1),o("span",{class:"volatility-level",style:j({color:"#000000",backgroundColor:Z[l.level]||"#6b7280"})}," ["+d(l.level)+"] ",5)],64))),128)):K("",!0)],6)}),128))])]),o("div",ct,[t[10]||(t[10]=o("div",{class:"metric-title"},"日均广告花费(30/15/7/3/1日)",-1)),o("div",ut,[(i(!0),r(m,null,C(e.adCostAvg,(a,g)=>(i(),r("span",{key:g,class:M(["metric-value","c"+g])},d(se(a)),3))),128))])]),o("div",dt,[t[11]||(t[11]=o("div",{class:"metric-title"},"广告花费短期波动相对长期基准(60)指标",-1)),o("div",vt,[(i(!0),r(m,null,C(X.filter(a=>a!==1),a=>{var g,w,V,B,F,x,A,L,D,S;return i(),r("span",{key:a,class:M(["volatility-item",{"volatility-highlight":((w=(g=e.adCostVolatilityBaseline)==null?void 0:g.find(l=>l.window===a))==null?void 0:w.level)==="明显"||((B=(V=e.adCostVolatilityBaseline)==null?void 0:V.find(l=>l.window===a))==null?void 0:B.level)==="剧烈","volatility-subtle":((x=(F=e.adCostVolatilityBaseline)==null?void 0:F.find(l=>l.window===a))==null?void 0:x.level)==="极小"||((L=(A=e.adCostVolatilityBaseline)==null?void 0:A.find(l=>l.window===a))==null?void 0:L.level)==="轻微"||((S=(D=e.adCostVolatilityBaseline)==null?void 0:D.find(l=>l.window===a))==null?void 0:S.level)==="一般"}]),style:j({borderColor:Y[a],backgroundColor:Y[a]+"40"})},[e.adCostVolatilityBaseline&&e.adCostVolatilityBaseline.find(l=>l.window===a)?(i(!0),r(m,{key:0},C(e.adCostVolatilityBaseline.filter(l=>l.window===a),l=>(i(),r(m,{key:l.window},[o("span",yt,d(a)+"天 ",1),o("span",gt,d(l.direction==="+"?"↑":"↓"),1),o("span",ft,d(Q(l.strength))+"% ",1),o("span",{class:"volatility-level",style:j({color:"#000000",backgroundColor:Z[l.level]||"#6b7280"})}," ["+d(l.level)+"] ",5)],64))),128)):K("",!0)],6)}),128))])]),o("div",mt,[t[12]||(t[12]=o("div",{class:"metric-title"},"日均销售额(30/15/7/3/1日)",-1)),o("div",_t,[(i(!0),r(m,null,C(e.salesAvg,(a,g)=>(i(),r("span",{key:g,class:M(["metric-value","c"+g])},d(pe(a)),3))),128))])]),o("div",pt,[t[13]||(t[13]=o("div",{class:"metric-title"},"销售额短期波动相对长期基准(60)指标",-1)),o("div",ht,[(i(!0),r(m,null,C(X.filter(a=>a!==1),a=>{var g,w,V,B,F,x,A,L,D,S;return i(),r("span",{key:a,class:M(["volatility-item",{"volatility-highlight":((w=(g=e.salesVolatilityBaseline)==null?void 0:g.find(l=>l.window===a))==null?void 0:w.level)==="明显"||((B=(V=e.salesVolatilityBaseline)==null?void 0:V.find(l=>l.window===a))==null?void 0:B.level)==="剧烈","volatility-subtle":((x=(F=e.salesVolatilityBaseline)==null?void 0:F.find(l=>l.window===a))==null?void 0:x.level)==="极小"||((L=(A=e.salesVolatilityBaseline)==null?void 0:A.find(l=>l.window===a))==null?void 0:L.level)==="轻微"||((S=(D=e.salesVolatilityBaseline)==null?void 0:D.find(l=>l.window===a))==null?void 0:S.level)==="一般"}]),style:j({borderColor:Y[a],backgroundColor:Y[a]+"40"})},[e.salesVolatilityBaseline&&e.salesVolatilityBaseline.find(l=>l.window===a)?(i(!0),r(m,{key:0},C(e.salesVolatilityBaseline.filter(l=>l.window===a),l=>(i(),r(m,{key:l.window},[o("span",Ct,d(a)+"天 ",1),o("span",bt,d(l.direction==="+"?"↑":"↓"),1),o("span",kt,d(Q(l.strength))+"% ",1),o("span",{class:"volatility-level",style:j({color:"#FFFFFF",backgroundColor:Z[l.level]||"#6b7280"})}," ["+d(l.level)+"] ",5)],64))),128)):K("",!0)],6)}),128))])])])):K("",!0)]),_:2},1032,["class"]))),128))]),o("div",wt,[E(Ve,{"current-page":p.value,"onUpdate:currentPage":t[3]||(t[3]=e=>p.value=e),"page-size":h.value,"onUpdate:pageSize":t[4]||(t[4]=e=>h.value=e),"page-sizes":[10,20,50,100],total:fe.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:t[5]||(t[5]=()=>p.value=1)},null,8,["current-page","page-size","total"])])])}}}),Dt=Pe(Vt,[["__scopeId","data-v-b2ea6c31"]]);export{Dt as default};
