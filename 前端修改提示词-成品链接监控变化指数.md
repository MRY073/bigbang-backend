# 前端修改提示词：成品链接监控 - 已更新为滑动窗口波动率

## ⚠️ 重要提示

**此文档已过时！** 后端API已更新为使用**滑动窗口波动率（Sliding Volatility）**，不再使用变化指数。

**请查看最新文档：** `前端修改提示词-成品链接监控-滑动窗口波动率.md`

---

## 📋 历史记录（已废弃）

后端API接口 `/api/finished/link/monitor/list` 的返回数据结构已更新，将**标准差（Std）**改为**变化指数（ChangeIndex）**。需要修改前端代码以适配新的数据结构。

**注意：** 此版本已被滑动窗口波动率替代，请勿使用。

---

## 🔄 API接口信息

**接口路径：** `GET /api/finished/link/monitor/list`

**查询参数：**
- `shopID` (必填): 店铺ID
- `shopName` (必填): 店铺名称  
- `date` (可选): 日期，格式 YYYY-MM-DD

**响应格式：**
```json
{
  "success": true,
  "message": "查询成功",
  "data": [
    {
      "id": "商品ID",
      "name": "商品名称",
      "image": "商品主图URL",
      "visitorsAvg": [30日均值, 15日均值, 7日均值, 3日均值, 1日均值],
      "visitorsChangeIndex": [
        {
          "direction": "+" | "-",
          "strength": 25.5,
          "level": "极小" | "轻微" | "一般" | "明显" | "剧烈"
        },
        // ... 共5个元素，对应30/15/7/3/1天
      ],
      "adCostAvg": [30日均值, 15日均值, 7日均值, 3日均值, 1日均值],
      "adCostChangeIndex": [
        {
          "direction": "+" | "-",
          "strength": 35.2,
          "level": "极小" | "轻微" | "一般" | "明显" | "剧烈"
        },
        // ... 共5个元素
      ],
      "salesAvg": [30日均值, 15日均值, 7日均值, 3日均值, 1日均值],
      "salesChangeIndex": [
        {
          "direction": "+" | "-",
          "strength": 42.8,
          "level": "极小" | "轻微" | "一般" | "明显" | "剧烈"
        },
        // ... 共5个元素
      ],
      "warningLevel": "严重" | "一般" | "轻微" | "正常",
      "warningMessages": [
        "访客数波动较大，趋势上升，变化强度45.20%，需要关注趋势变化",
        "销售额波动剧烈，趋势下降，变化强度78.50%，风险较高，建议及时处理"
      ]
    }
  ]
}
```

---

## ⚠️ 数据结构变化

### 旧数据结构（已废弃）
```typescript
{
  visitorsStd: number[];      // 访客数标准差数组
  adCostStd: number[];        // 广告花费标准差数组
  salesStd: number[];         // 销售额标准差数组
}
```

### 新数据结构
```typescript
{
  visitorsChangeIndex: Array<{
    direction: '+' | '-';     // 变化方向：+上升，-下降
    strength: number;         // 变化强度：0-100
    level: '极小' | '轻微' | '一般' | '明显' | '剧烈';  // 变化等级
  }>;
  adCostChangeIndex: Array<{
    direction: '+' | '-';
    strength: number;
    level: '极小' | '轻微' | '一般' | '明显' | '剧烈';
  }>;
  salesChangeIndex: Array<{
    direction: '+' | '-';
    strength: number;
    level: '极小' | '轻微' | '一般' | '明显' | '剧烈';
  }>;
  warningMessages: string[];  // 新增：警告提示语数组
}
```

---

## 🎨 UI显示要求

### 1. 变化指数显示格式

每个时间维度（30/15/7/3/1天）的变化指数需要显示：
- **方向图标**：`+` 显示上升箭头（↑）或绿色，`-` 显示下降箭头（↓）或红色
- **强度数值**：显示为百分比，保留2位小数，例如 `25.50%`
- **等级标签**：显示中文等级（极小/轻微/一般/明显/剧烈）

**示例显示：**
```
访客数变化指数：
30天：↑ 15.20% [轻微]  15天：↓ 8.50% [极小]  7天：↑ 32.40% [一般]  3天：↓ 55.80% [明显]  1天：↑ 78.90% [剧烈]
```

### 2. 颜色方案（重要：5个维度需要不同颜色）

**时间维度颜色分配：**
- **30天**：深蓝色 `#1e40af` 或 `#2563eb`
- **15天**：蓝色 `#3b82f6` 或 `#60a5fa`
- **7天**：青色 `#06b6d4` 或 `#22d3ee`
- **3天**：橙色 `#f59e0b` 或 `#f97316`
- **1天**：红色 `#ef4444` 或 `#dc2626`

**变化等级颜色：**
- **极小**：灰色 `#6b7280` - 基本稳定
- **轻微**：绿色 `#10b981` - 轻微波动
- **一般**：黄色 `#f59e0b` - 中等波动，值得关注
- **明显**：橙色 `#f97316` - 波动较大，需要关注
- **剧烈**：红色 `#ef4444` - 波动剧烈，风险高

**方向颜色：**
- **上升（+）**：绿色系 `#10b981` 或 `#22c55e`
- **下降（-）**：红色系 `#ef4444` 或 `#dc2626`

### 3. 警告信息显示

在商品卡片或详情区域显示 `warningMessages` 数组中的警告提示语：
- 使用警告样式（黄色/橙色背景，或带图标）
- 每条警告信息单独一行显示
- 如果没有警告信息，不显示警告区域

### 4. 预警等级显示

`warningLevel` 字段显示预警等级，使用对应的颜色：
- **严重**：红色背景/边框
- **一般**：橙色背景/边框
- **轻微**：黄色背景/边框
- **正常**：绿色背景/边框或灰色

---

## 📝 需要修改的文件和位置

### 1. TypeScript 类型定义文件

**查找位置：** `types/` 或 `interfaces/` 或组件文件中的类型定义

**需要修改：**
```typescript
// 旧类型（删除或注释）
interface FinishedLinkMonitorItem {
  visitorsStd: number[];
  adCostStd: number[];
  salesStd: number[];
  // ...
}

// 新类型（替换）
interface FinishedLinkMonitorItem {
  visitorsChangeIndex: Array<{
    direction: '+' | '-';
    strength: number;
    level: '极小' | '轻微' | '一般' | '明显' | '剧烈';
  }>;
  adCostChangeIndex: Array<{
    direction: '+' | '-';
    strength: number;
    level: '极小' | '轻微' | '一般' | '明显' | '剧烈';
  }>;
  salesChangeIndex: Array<{
    direction: '+' | '-';
    strength: number;
    level: '极小' | '轻微' | '一般' | '明显' | '剧烈';
  }>;
  warningMessages: string[];
  // ...
}
```

### 2. 数据展示组件

**需要修改的地方：**

1. **访客数标准差显示** → **访客数变化指数显示**
   - 旧：`item.visitorsStd[index]` 
   - 新：`item.visitorsChangeIndex[index]`，显示 `direction`、`strength`、`level`

2. **广告花费标准差显示** → **广告花费变化指数显示**
   - 旧：`item.adCostStd[index]`
   - 新：`item.adCostChangeIndex[index]`

3. **销售额标准差显示** → **销售额变化指数显示**
   - 旧：`item.salesStd[index]`
   - 新：`item.salesChangeIndex[index]`

4. **新增警告信息显示**
   - 显示 `item.warningMessages` 数组

### 3. 示例代码片段

```tsx
// 渲染变化指数的组件函数
const renderChangeIndex = (
  changeIndex: {
    direction: '+' | '-';
    strength: number;
    level: '极小' | '轻微' | '一般' | '明显' | '剧烈';
  },
  dimensionColor: string
) => {
  const directionColor = changeIndex.direction === '+' ? '#10b981' : '#ef4444';
  const levelColors = {
    '极小': '#6b7280',
    '轻微': '#10b981',
    '一般': '#f59e0b',
    '明显': '#f97316',
    '剧烈': '#ef4444'
  };

  return (
    <span style={{ color: dimensionColor }}>
      {changeIndex.direction === '+' ? '↑' : '↓'} 
      <span style={{ color: directionColor }}>
        {changeIndex.strength.toFixed(2)}%
      </span>
      <span style={{ 
        color: levelColors[changeIndex.level],
        marginLeft: '4px',
        padding: '2px 6px',
        borderRadius: '4px',
        backgroundColor: `${levelColors[changeIndex.level]}20`
      }}>
        [{changeIndex.level}]
      </span>
    </span>
  );
};

// 在组件中使用
const timeDimensions = ['30天', '15天', '7天', '3天', '1天'];
const dimensionColors = ['#1e40af', '#3b82f6', '#06b6d4', '#f59e0b', '#ef4444'];

{item.visitorsChangeIndex.map((changeIndex, index) => (
  <div key={index}>
    <span>{timeDimensions[index]}: </span>
    {renderChangeIndex(changeIndex, dimensionColors[index])}
  </div>
))}
```

---

## ✅ 检查清单

修改完成后，请确认：

- [ ] TypeScript 类型定义已更新
- [ ] 所有使用 `visitorsStd`、`adCostStd`、`salesStd` 的地方已替换为 `visitorsChangeIndex`、`adCostChangeIndex`、`salesChangeIndex`
- [ ] 变化指数正确显示方向、强度、等级
- [ ] 5个时间维度使用了不同的颜色区分
- [ ] 变化等级使用了对应的颜色
- [ ] 警告信息（`warningMessages`）已正确显示
- [ ] 预警等级（`warningLevel`）使用了对应的颜色
- [ ] 没有 TypeScript 类型错误
- [ ] 没有控制台错误
- [ ] UI 显示美观，易于区分不同维度

---

## 📌 注意事项

1. **数组索引对应关系：**
   - 索引 0 = 30天
   - 索引 1 = 15天
   - 索引 2 = 7天
   - 索引 3 = 3天
   - 索引 4 = 1天

2. **变化强度数值：**
   - 范围：0-100
   - 显示时保留2位小数
   - 单位：百分比（%）

3. **变化等级含义：**
   - **极小**（0-10）：基本稳定，几乎无波动
   - **轻微**（10-30）：轻微波动，不影响判断
   - **一般**（30-60）：中等波动，值得关注
   - **明显**（60-80）：波动较大，需要关注趋势
   - **剧烈**（80-100）：波动非常大，风险高

4. **方向含义：**
   - `+`：整体趋势上升
   - `-`：整体趋势下降

---

## 🎯 预期效果

修改完成后，页面应该：
- 清晰显示每个时间维度的变化指数（方向、强度、等级）
- 使用不同颜色区分5个时间维度
- 使用颜色和图标直观显示变化方向和等级
- 在明显位置显示警告信息
- 整体视觉效果美观，信息层次清晰

